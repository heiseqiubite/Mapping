import{ay as e,az as a,bv as t,bl as l,ch as s,al as o,d as r,ak as i,r as d,ad as n,S as c,c as u,o as p,i as m,ar as v,aY as g,a as f,w as j,J as y,C as _,n as b,b5 as x,b4 as h,aM as k,f as w,u as C,h as S,g as z,F as E,G as P,E as V,dM as D,y as A,x as T,t as U,Q as L,p as F,l as q,j as B,am as I,H as M,s as R,_ as N}from"./index-C335Dbyp.js";import{E as $,a as G,b as H}from"./el-dropdown-item-ypTXrub9.js";import"./el-popper-BdVQ-fi9.js";import{E as J}from"./el-pagination-C3mrmel7.js";import{E as O}from"./el-tag-DSkaNW9P.js";import"./el-select-DxgVe2hv.js";import{E as W}from"./el-checkbox-CqOvfBK0.js";import{E as K}from"./el-switch-B1hfvIWf.js";import{E as Q,a as X}from"./el-form-UGjKpEwN.js";import{E as Y}from"./el-upload-C8adnv6v.js";import"./el-progress-Dj_7FjH7.js";import{_ as Z}from"./Dialog.vue_vue_type_style_index_0_lang-D8ePpfD3.js";import{u as ee,d as ae}from"./index-CQ8vTVrh.js";import{_ as te}from"./AddProject.vue_vue_type_script_setup_true_lang-D36u-Sp8.js";import{u as le}from"./useIcon-CkTT0Usi.js";import"./castArray-DcfcP02G.js";import"./refs-Dt1UrLcT.js";import"./index-BWY9zJxx.js";import"./index-9a9sxpBE.js";import"./strings-BnBs96OV.js";import"./debounce-Bhx9ODHg.js";import"./index-DcJJBfbp.js";import"./index-D4TQOvlj.js";import"./el-divider-BZYcCevV.js";import"./el-col-CoU3axbs.js";import"./el-tooltip-l0sNRNKZ.js";import"./el-radio-group-C80jDT57.js";import"./el-virtual-list-B4IL-mhu.js";import"./raf-iuS8F68J.js";import"./el-select-v2-4evr8ql9.js";import"./el-input-number-Ca7WmFBy.js";import"./el-text-Db18Yw9k.js";import"./index-Db6MGsay.js";import"./index-nItDL_e6.js";import"./DetailTemplate-CVhzJ-nT.js";import"./el-card-BWWcY-2r.js";/* empty css                */import"./index-CXxCiI03.js";import"./index-2Y-wxM3q.js";const se=e({size:{type:[Number,String],values:s,default:"",validator:e=>l(e)},shape:{type:String,values:["circle","square"],default:"circle"},icon:{type:t},src:{type:String,default:""},alt:String,srcSet:String,fit:{type:a(String),default:"cover"}}),oe={error:e=>e instanceof Event},re=r({name:"ElAvatar"});const ie=k(o(r({...re,props:se,emits:oe,setup(e,{emit:a}){const t=e,s=i("avatar"),o=d(!1),r=n((()=>{const{size:e,icon:a,shape:l}=t,o=[s.b()];return x(e)&&o.push(s.m(e)),a&&o.push(s.m("icon")),l&&o.push(s.m(l)),o})),k=n((()=>{const{size:e}=t;return l(e)?s.cssVarBlock({size:h(e)||""}):void 0})),w=n((()=>({objectFit:t.fit})));function C(e){o.value=!0,a("error",e)}return c((()=>t.src),(()=>o.value=!1)),(e,a)=>(p(),u("span",{class:b(f(r)),style:g(f(k))},[!e.src&&!e.srcSet||o.value?e.icon?(p(),m(f(_),{key:1},{default:j((()=>[(p(),m(y(e.icon)))])),_:1})):v(e.$slots,"default",{key:2}):(p(),u("img",{key:0,src:e.src,alt:e.alt,srcset:e.srcSet,style:g(f(w)),onError:C},null,44,["src","alt","srcset"]))],6))}}),[["__file","avatar.vue"]])),de=e=>(F("data-v-a7fa45f7"),e=e(),q(),e),ne={class:"project-list"},ce={class:"project-grid"},ue=["onClick"],pe={class:"card-header"},me={class:"avatar-container"},ve={class:"card-body"},ge={class:"project-name"},fe={class:"project-tag"},je={class:"project-stats"},ye=de((()=>S("data",null,null,-1))),_e={class:"pagination"},be={class:"upload-dialog-content"},xe=de((()=>S("div",{class:"el-upload__text"},[T(" 将文件拖到此处，或"),S("em",null,"点击上传")],-1))),he={class:"dialog-footer"},ke=N(r({__name:"ProjectList",props:{tableDataList:{type:Array,default:()=>[]},getProjectTag:{type:Function,required:!0},total:{type:Number,default:0},multipleSelection:{type:Boolean},selectedRows:{type:Array,default:()=>[]}},setup(e){const{t:a}=w(),{push:t}=C(),l=e;d(!1);let s="";const o=d(!1),r=()=>{o.value=!1},i=le({icon:"ep:edit"}),n=le({icon:"ep:delete"}),v=le({icon:"ep:data-analysis"}),g=le({icon:"ep:upload"}),y=d(!1),b=d(""),x=d(),h=d(!1),k=d({tag:"",file:null}),F={tag:[{required:!0,message:"请输入项目标签",trigger:"blur"},{min:1,max:50,message:"标签长度应在 1 到 50 个字符",trigger:"blur"}]},q=async e=>{switch(e.type){case"edit":(async e=>{s=e,o.value=!0})(e.id);break;case"del":const r=d(!1);M({title:"Delete",draggable:!0,message:()=>R("div",{style:{display:"flex",alignItems:"center"}},[R("p",{style:{margin:"0 10px 0 0"}},a("task.delAsset")),R(K,{modelValue:r.value,"onUpdate:modelValue":e=>{r.value=e}})])}).then((async()=>{await ae([e.id],r.value),l.getProjectTag(1,50)}));break;case"aggregation":t(`/project-management/project-detail?id=${e.id}`);break;case"upload":b.value=e.id,y.value=!0}},N=e=>{const a=e.raw;if(!a)return;if(a.size>10485760)return L.error("文件大小不能超过 10MB"),void(k.value.file=null);const t=a.name.toLowerCase();if(![".dat"].some((e=>t.endsWith(e))))return L.error("仅支持 .dat 格式文件"),void(k.value.file=null);k.value.file=a},se=async()=>{x.value&&await x.value.validate((async e=>{if(e)if(k.value.file)try{h.value=!0;const e=await ee(b.value,k.value.file);if(200!==e.code)throw new Error(e.message||"上传失败");L.success("文件上传成功！"),oe(),l.getProjectTag(re.value,de.value)}catch(a){L.error(a.message||"上传失败，请重试")}finally{h.value=!1}else L.error("请选择要上传的文件")}))},oe=()=>{var e;y.value=!1,k.value.tag="",k.value.file=null,null==(e=x.value)||e.resetFields()},re=d(1),de=d(50),ke=d(!1),we=d(!0),Ce=d(!1),Se=()=>{l.getProjectTag(re.value,de.value)},ze=d([]);c((()=>l.selectedRows),(e=>{ze.value=e})),c((()=>l.tableDataList),(e=>{Ee.value=ze.value.length===e.length}));const Ee=d(!1);return(d,c)=>(p(),u("div",ne,[S("div",ce,[(p(!0),u(E,null,P(e.tableDataList,(l=>(p(),u("div",{key:l.id,class:"project-card"},[S("div",{class:"card-content",onClick:e=>{return a=l.id,void t(`/project-management/project-detail?id=${a}`);var a}},[S("div",pe,[e.multipleSelection?(p(),m(f(W),{key:0,value:ze.value.includes(l.id),onClick:I((e=>((e,a)=>{e.preventDefault(),e.stopPropagation();const t=ze.value.indexOf(a);-1===t?ze.value.push(a):ze.value.splice(t,1)})(e,l.id)),["stop"]),class:"checkbox"},null,8,["value","onClick"])):B("",!0),S("div",me,[l.logo?(p(),m(f(ie),{key:0,src:l.logo,class:"avatar",fit:"cover"},null,8,["src"])):(p(),m(f(ie),{key:1,class:"avatar avatar-placeholder"},{default:j((()=>[T(U(l.name.charAt(0).toUpperCase()),1)])),_:2},1024))])]),S("div",ve,[S("h3",ge,U(l.name),1),S("div",fe,[z(f(O),{size:"small",effect:"plain"},{default:j((()=>[T(U(l.tag),1)])),_:2},1024)]),S("div",je,[z(f(_),null,{default:j((()=>[ye])),_:1}),S("span",null,U(f(a)("project.totalAssets"))+": "+U(l.AssetCount),1)])])],8,ue),z(f(H),{trigger:"contextmenu",onCommand:q,class:"card-dropdown"},{dropdown:j((()=>[z(f($),null,{default:j((()=>[z(f(G),{icon:f(i),command:{type:"edit",id:l.id}},{default:j((()=>[T(U(f(a)("common.edit")),1)])),_:2},1032,["icon","command"]),z(f(G),{icon:f(n),command:{type:"del",id:l.id}},{default:j((()=>[T(U(f(a)("common.delete")),1)])),_:2},1032,["icon","command"]),z(f(G),{icon:f(v),command:{type:"aggregation",id:l.id}},{default:j((()=>[T(U(f(a)("project.aggregation")),1)])),_:2},1032,["icon","command"]),z(f(G),{icon:f(g),command:{type:"upload",id:l.id}},{default:j((()=>[T(U(f(a)("common.uplaod")),1)])),_:2},1032,["icon","command"])])),_:2},1024)])),default:j((()=>[S("div",{class:"dropdown-trigger",onClick:c[0]||(c[0]=I((()=>{}),["stop"]))})])),_:2},1024)])))),128))]),S("div",_e,[z(f(J),{"current-page":re.value,"onUpdate:currentPage":c[1]||(c[1]=e=>re.value=e),"page-size":de.value,"onUpdate:pageSize":c[2]||(c[2]=e=>de.value=e),"page-sizes":[50,70,100,200,400],small:ke.value,disabled:Ce.value,background:we.value,layout:"total, sizes, prev, pager, next, jumper",total:e.total,onSizeChange:Se,onCurrentChange:Se},null,8,["current-page","page-size","small","disabled","background","total"])]),z(f(Z),{modelValue:o.value,"onUpdate:modelValue":c[3]||(c[3]=e=>o.value=e),title:f(a)("common.edit"),center:"",style:{"border-radius":"15px","box-shadow":"5px 5px 10px rgb(0 0 0 / 30%)"}},{default:j((()=>[z(te,{closeDialog:r,projectid:f(s),getProjectData:l.getProjectTag,schedule:!1},null,8,["projectid","getProjectData"])])),_:1},8,["modelValue","title"]),z(f(Z),{modelValue:y.value,"onUpdate:modelValue":c[5]||(c[5]=e=>y.value=e),title:"文件上传",center:"",width:"600px",style:{"border-radius":"15px","box-shadow":"5px 5px 10px rgb(0 0 0 / 30%)"}},{default:j((()=>[S("div",be,[z(f(Q),{ref_key:"uploadFormRef",ref:x,model:k.value,rules:F,"label-width":"80px",class:"upload-form"},{default:j((()=>[z(f(X),{label:"项目标签",prop:"tag"},{default:j((()=>[z(f(V),{modelValue:k.value.tag,"onUpdate:modelValue":c[4]||(c[4]=e=>k.value.tag=e),placeholder:"请输入项目标签",clearable:""},null,8,["modelValue"])])),_:1}),z(f(X),{label:"选择文件",prop:"file"},{default:j((()=>[z(f(Y),{class:"file-upload",drag:"","auto-upload":!1,"on-change":N,"show-file-list":!0,limit:1,accept:".dat"},{default:j((()=>[z(f(_),{class:"el-icon--upload"},{default:j((()=>[z(f(D))])),_:1}),xe])),_:1})])),_:1})])),_:1},8,["model"]),S("div",he,[z(f(A),{onClick:oe},{default:j((()=>[T("取消")])),_:1}),z(f(A),{type:"primary",loading:h.value,onClick:se,disabled:!k.value.file},{default:j((()=>[T(U(h.value?"上传中...":"开始上传"),1)])),_:1},8,["loading","disabled"])])])])),_:1},8,["modelValue"])]))}}),[["__scopeId","data-v-a7fa45f7"]]);export{ke as default};
