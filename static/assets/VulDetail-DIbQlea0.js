import{d as e,f as l,H as a,u as t,r as s,L as i,z as o,B as n,c as u,o as r,h as c,A as d,g as m,w as p,x as v,a as f,C as h,Y as g,t as y,y as b,i as _,F as w,G as k,Z as j,$ as x,j as E,a0 as C,a1 as z,a2 as V,Q as D,N as U,_ as $}from"./index-CzUwgbbU.js";import{E as B}from"./el-card-D90KorQn.js";import{E as H}from"./el-tag-uhvpNveH.js";import{E as L}from"./el-link-DpSP71sd.js";import{E as O,a as A}from"./el-table-column-DPc6MTPa.js";import"./el-checkbox-BalLSeP9.js";import"./el-tooltip-l0sNRNKZ.js";import"./el-popper-DVotpISH.js";import{E as F,a as I}from"./el-descriptions-item-Dl4rDpPs.js";import{E as S}from"./el-divider-8rja45mS.js";import{E as q}from"./el-empty-BmYl086o.js";import{_ as N}from"./Dialog.vue_vue_type_style_index_0_lang-DZBgpKQ0.js";import{g as R}from"./index-VJB1cQdx.js";import{u as T,d as W}from"./index-Dq6sezth.js";import"./isArrayLikeObject-Bwd_gmPF.js";import"./index-BYNKo7qk.js";import"./debounce-8wwtyAGg.js";import"./raf-Dzw5j5A8.js";import"./index-IhT-f-PJ.js";import"./refs-CzcJSp1f.js";import"./index-CyWn8tDN.js";const G={class:"vul-detail-container"},J={class:"back-button"},K={class:"card-header"},M={class:"title"},Q={key:0},Y={class:"vulnerability-name"},Z={class:"vulnerability-stats"},P={class:"url-cell"},X={class:"url-text"},ee={class:"time-cell"},le={class:"matched-cell"},ae={class:"action-buttons"},te={class:"code-block"},se={class:"code-block"},ie=$(e({__name:"VulDetail",setup(e){const{t:$}=l(),ie=a(),oe=t(),ne=ie.params.id,ue=s(null),re=s(!0),ce=s([]),de=s(!1),me=s(!1),pe=s(""),ve=s(""),fe=[{value:1,label:$("common.unprocessed")},{value:2,label:$("common.processing")},{value:3,label:$("common.ignored")},{value:4,label:$("common.suspected")},{value:5,label:$("common.confirmed")}],he=()=>{oe.go(-1)},ge=e=>{let l="",a="";return 5===e?(l="red",a=$("poc.critical")):4===e?(l="orange",a=$("poc.high")):3===e?(l="yellow",a=$("poc.medium")):2===e?(l="blue",a=$("poc.low")):1===e?(l="green",a=$("poc.info")):0===e&&(l="gray",a=$("poc.unknown")),{color:l,text:a}},ye=s(0),be=()=>{const e=window.innerHeight||document.documentElement.clientHeight;ye.value=.6*e};return i((()=>{be(),window.addEventListener("resize",be),(async()=>{try{re.value=!0;const e=await R(`id="${ne}"`,1,1,{});e.data.list&&e.data.list.length>0?(ue.value=e.data.list[0],ue.value.items&&ue.value.items.length>0?ce.value=ue.value.items.map(((e,l)=>{const a={...e};return a.id=`${ne}-item-${l}-${Date.now()}`,void 0!==a.status&&null!==a.status||(a.status=1),a})):ce.value=[]):(D.error($("common.dataNotFound")),he())}catch(e){D.error($("common.fetchFailed"))}finally{re.value=!1}})()})),(e,l)=>{const a=o("ElOption"),t=o("ElSelect"),s=n("loading");return r(),u("div",G,[c("div",J,[m(f(b),{type:"primary",plain:"",onClick:he},{default:p((()=>[m(f(h),null,{default:p((()=>[m(f(g))])),_:1}),v(" "+y(f($)("common.back")),1)])),_:1})]),d((r(),_(f(B),{class:"mb-4"},{header:p((()=>[c("div",K,[c("h3",M,y(f($)("asset.vulDetail")),1)])])),default:p((()=>[ue.value?(r(),u("div",Q,[m(f(F),{column:2,border:""},{default:p((()=>[m(f(I),{label:f($)("asset.vulnerability"),span:2},{default:p((()=>[c("span",Y,y(ue.value.vulnerability),1)])),_:1},8,["label"]),m(f(I),{label:f($)("poc.level")},{default:p((()=>[m(f(H),{type:5===ue.value.level?"danger":4===ue.value.level||3===ue.value.level?"warning":2===ue.value.level?"info":1===ue.value.level?"success":"info",size:"large"},{default:p((()=>[v(y(ge(ue.value.level).text),1)])),_:1},8,["type"])])),_:1},8,["label"]),m(f(I),{label:f($)("asset.count")},{default:p((()=>[v(y(ce.value.length),1)])),_:1},8,["label"])])),_:1}),m(f(S),null,{default:p((()=>[v(y(f($)("asset.vulItems")),1)])),_:1}),c("div",Z,[(r(),u(w,null,k(fe,(e=>m(f(H),{key:e.value,type:1===e.value?"warning":2===e.value?"info":3===e.value?"danger":4===e.value?"warning":"success",size:"small",class:"status-tag"},{default:p((()=>[v(y(e.label)+": "+y(ce.value.filter((l=>l.status===e.value)).length),1)])),_:2},1032,["type"]))),64))]),m(f(O),{data:ce.value,border:"",stripe:"",style:{width:"100%"},"max-height":ye.value,class:"custom-table mt-4","highlight-current-row":"","row-key":"id"},{default:p((()=>[m(f(A),{type:"selection",width:"55",align:"center"}),m(f(A),{type:"index",width:"50",align:"center",label:"序号"}),m(f(A),{prop:"url",label:"URL","min-width":"350","show-overflow-tooltip":"","class-name":"url-column",align:"left"},{default:p((({row:e})=>[c("div",P,[m(f(L),{href:e.url,type:"primary",target:"_blank",underline:!1,class:"url-link"},{default:p((()=>[m(f(h),{class:"link-icon"},{default:p((()=>[m(f(j))])),_:1}),c("span",X,y(e.url),1)])),_:2},1032,["href"])])])),_:1}),m(f(A),{prop:"status",label:"状态",width:"200",align:"center"},{default:p((({row:e})=>[m(t,{modelValue:e.status,"onUpdate:modelValue":l=>e.status=l,size:"default",style:{width:"130px"},onChange:l=>(async(e,l)=>{try{await T(e.id,"vulnerability",l),e.status=l,D.success($("common.updateSuccess"))}catch(a){D.error($("common.updateError"))}})(e,l),class:"status-select"},{default:p((()=>[(r(),u(w,null,k(fe,(e=>m(a,{key:e.value,label:e.label,value:e.value},{default:p((()=>[m(f(H),{size:"small",type:1===e.value?"warning":2===e.value?"info":3===e.value?"danger":4===e.value?"warning":"success"},{default:p((()=>[v(y(e.label),1)])),_:2},1032,["type"])])),_:2},1032,["label","value"]))),64))])),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),m(f(A),{prop:"time",label:"发现时间",width:"300",align:"center"},{default:p((({row:e})=>[c("div",ee,[m(f(h),null,{default:p((()=>[m(f(x))])),_:1}),c("span",null,y(e.time),1)])])),_:1}),m(f(A),{prop:"matched",label:"匹配内容","min-width":"200","show-overflow-tooltip":""},{default:p((({row:e})=>[c("div",le,y(e.matched||"-"),1)])),_:1}),m(f(A),{label:"操作",width:"280",align:"center",fixed:"right"},{default:p((({row:e})=>[c("div",ae,[e.request?(r(),_(f(b),{key:0,size:"small",type:"primary",plain:"",onClick:l=>(e=>{pe.value=e.request,de.value=!0})(e)},{default:p((()=>[m(f(h),null,{default:p((()=>[m(f(C))])),_:1}),v(" 请求 ")])),_:2},1032,["onClick"])):E("",!0),e.response?(r(),_(f(b),{key:1,size:"small",type:"success",plain:"",onClick:l=>(e=>{ve.value=e.response,me.value=!0})(e)},{default:p((()=>[m(f(h),null,{default:p((()=>[m(f(z))])),_:1}),v(" 响应 ")])),_:2},1032,["onClick"])):E("",!0),m(f(b),{size:"small",type:"danger",plain:"",onClick:l=>(async e=>{e.id?U.confirm("Whether to delete?","Warning",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning"}).then((async()=>{try{const l=e.id;await W([l],"vulnerability"),D.success($("common.deleteSuccess")),ce.value=ce.value.filter((l=>l.id!==e.id))}catch(l){D.error($("common.deleteError"))}})).catch((()=>{D({type:"info",message:"Delete canceled"})})):D.warning($("common.noId"))})(e)},{default:p((()=>[m(f(h),null,{default:p((()=>[m(f(V))])),_:1}),v(" 删除 ")])),_:2},1032,["onClick"])])])),_:1})])),_:1},8,["data","max-height"])])):(r(),_(f(q),{key:1,description:"暂无数据"}))])),_:1})),[[s,re.value]]),m(f(N),{modelValue:de.value,"onUpdate:modelValue":l[0]||(l[0]=e=>de.value=e),title:"请求详情",width:"60%"},{default:p((()=>[c("pre",te,y(pe.value),1)])),_:1},8,["modelValue"]),m(f(N),{modelValue:me.value,"onUpdate:modelValue":l[1]||(l[1]=e=>me.value=e),title:"响应详情",width:"60%"},{default:p((()=>[c("pre",se,y(ve.value),1)])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-93d8cbd0"]]);export{ie as default};
