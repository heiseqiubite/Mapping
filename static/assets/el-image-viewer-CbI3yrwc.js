import{cX as e,bl as a,ay as s,az as t,bt as n,al as l,d as o,bA as i,dC as r,dD as c,as as u,ak as d,c1 as f,r as v,dE as m,b3 as p,ad as b,S as g,L as k,bC as y,i as x,o as w,w as h,g as C,T as I,h as _,aY as z,n as O,a as N,c2 as T,j as A,c as L,ar as R,am as E,C as Y,be as $,F as S,br as X,an as F,x as M,t as P,dF as D,cG as j,I as B,dG as G,dH as W,G as H,dI as J,aJ as V,a3 as q,aM as K}from"./index-CzUwgbbU.js";import{E as Z}from"./index-IhT-f-PJ.js";import{d as Q}from"./debounce-8wwtyAGg.js";function U(a,s,t){var n=!0,l=!0;if("function"!=typeof a)throw new TypeError("Expected a function");return e(t)&&(n="leading"in t?!!t.leading:n,l="trailing"in t?!!t.trailing:l),Q(a,s,{leading:n,maxWait:s,trailing:l})}const ee=s({urlList:{type:t(Array),default:()=>n([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:{type:Boolean,default:!1},crossorigin:{type:t(String)}}),ae={close:()=>!0,switch:e=>a(e),rotate:e=>a(e)},se=o({name:"ElImageViewer"});const te=K(l(o({...se,props:ee,emits:ae,setup(e,{expose:a,emit:s}){var t;const n=e,l={CONTAIN:{name:"contain",icon:i(c)},ORIGINAL:{name:"original",icon:i(r)}};let o,K="";const{t:Q}=u(),ee=d("image-viewer"),{nextZIndex:ae}=f(),se=v(),te=v([]),ne=m(),le=v(!0),oe=v(n.initialIndex),ie=p(l.CONTAIN),re=v({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),ce=v(null!=(t=n.zIndex)?t:ae()),ue=b((()=>{const{urlList:e}=n;return e.length<=1})),de=b((()=>0===oe.value)),fe=b((()=>oe.value===n.urlList.length-1)),ve=b((()=>n.urlList[oe.value])),me=b((()=>[ee.e("btn"),ee.e("prev"),ee.is("disabled",!n.infinite&&de.value)])),pe=b((()=>[ee.e("btn"),ee.e("next"),ee.is("disabled",!n.infinite&&fe.value)])),be=b((()=>{const{scale:e,deg:a,offsetX:s,offsetY:t,enableTransition:n}=re.value;let o=s/e,i=t/e;const r=a*Math.PI/180,c=Math.cos(r),u=Math.sin(r);o=o*c+i*u,i=i*c-s/e*u;const d={transform:`scale(${e}) rotate(${a}deg) translate(${o}px, ${i}px)`,transition:n?"transform .3s":""};return ie.value.name===l.CONTAIN.name&&(d.maxWidth=d.maxHeight="100%"),d})),ge=b((()=>`${oe.value+1} / ${n.urlList.length}`));function ke(){ne.stop(),null==o||o(),document.body.style.overflow=K,s("close")}function ye(){le.value=!1}function xe(e){le.value=!1,e.target.alt=Q("el.image.error")}function we(e){if(le.value||0!==e.button||!se.value)return;re.value.enableTransition=!1;const{offsetX:a,offsetY:s}=re.value,t=e.pageX,n=e.pageY,l=U((e=>{re.value={...re.value,offsetX:a+e.pageX-t,offsetY:s+e.pageY-n}})),o=y(document,"mousemove",l);y(document,"mouseup",(()=>{o()})),e.preventDefault()}function he(){re.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function Ce(){if(le.value)return;const e=J(l),a=Object.values(l),s=ie.value.name,t=(a.findIndex((e=>e.name===s))+1)%e.length;ie.value=l[e[t]],he()}function Ie(e){const a=n.urlList.length;oe.value=(e+a)%a}function _e(){de.value&&!n.infinite||Ie(oe.value-1)}function ze(){fe.value&&!n.infinite||Ie(oe.value+1)}function Oe(e,a={}){if(le.value)return;const{minScale:t,maxScale:l}=n,{zoomRate:o,rotateDeg:i,enableTransition:r}={zoomRate:n.zoomRate,rotateDeg:90,enableTransition:!0,...a};switch(e){case"zoomOut":re.value.scale>t&&(re.value.scale=Number.parseFloat((re.value.scale/o).toFixed(3)));break;case"zoomIn":re.value.scale<l&&(re.value.scale=Number.parseFloat((re.value.scale*o).toFixed(3)));break;case"clockwise":re.value.deg+=i,s("rotate",re.value.deg);break;case"anticlockwise":re.value.deg-=i,s("rotate",re.value.deg)}re.value.enableTransition=r}function Ne(e){var a;"pointer"===(null==(a=e.detail)?void 0:a.focusReason)&&e.preventDefault()}function Te(){n.closeOnPressEscape&&ke()}function Ae(e){if(e.ctrlKey)return e.deltaY<0||e.deltaY>0?(e.preventDefault(),!1):void 0}return g(ve,(()=>{q((()=>{const e=te.value[0];(null==e?void 0:e.complete)||(le.value=!0)}))})),g(oe,(e=>{he(),s("switch",e)})),k((()=>{!function(){const e=U((e=>{switch(e.code){case V.esc:n.closeOnPressEscape&&ke();break;case V.space:Ce();break;case V.left:_e();break;case V.up:Oe("zoomIn");break;case V.right:ze();break;case V.down:Oe("zoomOut")}})),a=U((e=>{Oe((e.deltaY||e.deltaX)<0?"zoomIn":"zoomOut",{zoomRate:n.zoomRate,enableTransition:!1})}));ne.run((()=>{y(document,"keydown",e),y(document,"wheel",a)}))}(),o=y("wheel",Ae,{passive:!1}),K=document.body.style.overflow,document.body.style.overflow="hidden"})),a({setActiveItem:Ie}),(e,a)=>(w(),x(N(Z),{to:"body",disabled:!e.teleported},{default:h((()=>[C(I,{name:"viewer-fade",appear:""},{default:h((()=>[_("div",{ref_key:"wrapper",ref:se,tabindex:-1,class:O(N(ee).e("wrapper")),style:z({zIndex:ce.value})},[C(N(T),{loop:"",trapped:"","focus-trap-el":se.value,"focus-start-el":"container",onFocusoutPrevented:Ne,onReleaseRequested:Te},{default:h((()=>[_("div",{class:O(N(ee).e("mask")),onClick:E((a=>e.hideOnClickModal&&ke()),["self"])},null,10,["onClick"]),A(" CLOSE "),_("span",{class:O([N(ee).e("btn"),N(ee).e("close")]),onClick:ke},[C(N(Y),null,{default:h((()=>[C(N($))])),_:1})],2),A(" ARROW "),N(ue)?A("v-if",!0):(w(),L(S,{key:0},[_("span",{class:O(N(me)),onClick:_e},[C(N(Y),null,{default:h((()=>[C(N(X))])),_:1})],2),_("span",{class:O(N(pe)),onClick:ze},[C(N(Y),null,{default:h((()=>[C(N(F))])),_:1})],2)],64)),e.$slots.progress||e.showProgress?(w(),L("div",{key:1,class:O([N(ee).e("btn"),N(ee).e("progress")])},[R(e.$slots,"progress",{activeIndex:oe.value,total:e.urlList.length},(()=>[M(P(N(ge)),1)]))],2)):A("v-if",!0),A(" ACTIONS "),_("div",{class:O([N(ee).e("btn"),N(ee).e("actions")])},[_("div",{class:O(N(ee).e("actions__inner"))},[R(e.$slots,"toolbar",{actions:Oe,prev:_e,next:ze,reset:Ce,activeIndex:oe.value,setActiveItem:Ie},(()=>[C(N(Y),{onClick:e=>Oe("zoomOut")},{default:h((()=>[C(N(D))])),_:1},8,["onClick"]),C(N(Y),{onClick:e=>Oe("zoomIn")},{default:h((()=>[C(N(j))])),_:1},8,["onClick"]),_("i",{class:O(N(ee).e("actions__divider"))},null,2),C(N(Y),{onClick:Ce},{default:h((()=>[(w(),x(B(N(ie).icon)))])),_:1}),_("i",{class:O(N(ee).e("actions__divider"))},null,2),C(N(Y),{onClick:e=>Oe("anticlockwise")},{default:h((()=>[C(N(G))])),_:1},8,["onClick"]),C(N(Y),{onClick:e=>Oe("clockwise")},{default:h((()=>[C(N(W))])),_:1},8,["onClick"])]))],2)],2),A(" CANVAS "),_("div",{class:O(N(ee).e("canvas"))},[(w(!0),L(S,null,H(e.urlList,((a,s)=>(w(),L(S,{key:s},[s===oe.value?(w(),L("img",{key:0,ref_for:!0,ref:e=>te.value[s]=e,src:a,style:z(N(be)),class:O(N(ee).e("img")),crossorigin:e.crossorigin,onLoad:ye,onError:xe,onMousedown:we},null,46,["src","crossorigin"])):A("v-if",!0)],64)))),128))],2),R(e.$slots,"default")])),_:3},8,["focus-trap-el"])],6)])),_:3})])),_:3},8,["disabled"]))}}),[["__file","image-viewer.vue"]]));export{te as E};
