import{d as e,f as t,r as l,q as a,g as i,s,M as o,x as n,F as r,J as u,c as p,o as d,a as m,w as c,R as v,E as f,y as g,a4 as h,A as y,B as x,i as b,V as j,j as _,h as w,S as V,t as S,G as k,P as C,Q as E,_ as L}from"./index-Bsz_-kew.js";import{u as R}from"./useTable-DOsThTKn.js";import{E as z}from"./el-card-DHQ8n2iG.js";import{E as U}from"./el-pagination-C7pJ8QU5.js";import{E as A}from"./el-tag-BK85rvDV.js";import{E as H,a as T}from"./el-select-CsCiNFSq.js";import"./el-popper-DexwxjEf.js";import{a as I,E as N}from"./el-col-CstzfiNs.js";import{E as D,a as O}from"./el-descriptions-item-Caxy6qlO.js";import{E as P}from"./el-text-LCHv_yYZ.js";import{E as q,a as F}from"./el-collapse-item-T4IOYdT8.js";import{_ as W}from"./Dialog.vue_vue_type_style_index_0_lang-CCL6sVJk.js";import{_ as M}from"./Table.vue_vue_type_script_lang-DEQW24mX.js";import{u as $}from"./useCrudSchemas-Ba_bG5_D.js";import{g as B}from"./index-shxngdc5.js";import J from"./Csearch-CSW43f3_.js";import{y as K,a as G,b as Q,u as X}from"./index-COM1-P1v.js";import{_ as Y}from"./Detail.vue_vue_type_script_setup_true_lang-BWj6dA3t.js";import{c as Z}from"./index-kK6Ub8M_.js";import"./index-BS16aHrW.js";import"./strings-zWyb0xsZ.js";import"./castArray-BltnW2TK.js";import"./debounce-Bd5c_m29.js";import"./index--g20Cokp.js";import"./index-I44EMqWl.js";import"./index-J8gc4mN7.js";import"./refs-CimMBFwC.js";import"./el-table-column-CDjS8A0j.js";import"./isArrayLikeObject-DvVlT94e.js";import"./el-checkbox-C6S6n9Ra.js";import"./raf-CfAM2lGy.js";import"./el-tooltip-l0sNRNKZ.js";import"./el-image-viewer-D8G6B48i.js";import"./el-empty-IOBAAoiF.js";import"./tsxHelper-D30aWQ_5.js";import"./el-dropdown-item-CWLlQn2E.js";import"./index-CVJINu6s.js";import"./tree-BfZhwLPs.js";import"./index-DpC9HCFr.js";import"./ContentWrap.vue_vue_type_script_setup_true_lang-DaYN3Raa.js";import"./el-divider-B98uacGM.js";import"./el-autocomplete-aHpLnkvK.js";/* empty css                */import"./el-tree-select-BLWE9X0m.js";import"./el-switch-DvKrBy-d.js";import"./useIcon-CR_HcNa1.js";import"./exportData.vue_vue_type_script_setup_true_lang-BDjNv10t.js";import"./el-tab-pane-WnKWzXw4.js";import"./el-form-BuXRuL0p.js";import"./el-radio-group-CszH4UBq.js";import"./el-space-Bk13ttH_.js";/* empty css                          */import"./AddTask.vue_vue_type_script_setup_true_lang-BrY7O3Hl.js";import"./el-virtual-list-Dx78Fvg-.js";import"./el-select-v2-Bkw3mN9B.js";import"./index-DkjGGqJB.js";import"./index-DhTuOjm6.js";import"./DetailTemplate-D15bCnIS.js";import"./index-DfBP4C7Z.js";import"./index-Dd6OwE5S.js";import"./index-BuCXGCts.js";const ee={key:0,style:{"text-align":"center",padding:"20px",color:"var(--el-text-color-secondary)"}},te=["onClick"],le={style:{whiteSpace:"pre-line",width:"500px"}},ae={style:{whiteSpace:"pre-line"}};function ie(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!E(e)}const se=L(e({__name:"vul",props:{projectList:{},projectId:{}},setup(e){const{t:E}=t(),L=e,se=[{keyword:"url",example:'url="http://example.com"',explain:E("searchHelp.url")},{keyword:"vulname",example:'vulname="nginxwebui-runcmd-rce"',explain:E("searchHelp.vulname")},{keyword:"level",example:'level="info"',explain:E("searchHelp.level")},{keyword:"matched",example:'matched="https://example.com"',explain:E("searchHelp.matched")},{keyword:"request",example:'request="cmd=whoami"',explain:E("searchHelp.vulRequest")},{keyword:"response",example:'response="root"',explain:E("searchHelp.response")},{keyword:"project",example:'project="Hackerone"',explain:E("searchHelp.project")}],oe=l(""),ne=e=>{oe.value=e,Le(),ce()},re=l(!1),ue=l(["1"]),pe=l(!1),de=l({VulNames:[]});let me=null;const ce=async()=>{pe.value||(me&&clearTimeout(me),me=setTimeout((async()=>{re.value=!0,de.value.VulNames=[];try{const e=await K(oe.value,xe);e.data&&Array.isArray(e.data.Vul)?de.value.VulNames=e.data.Vul:de.value.VulNames=[]}catch(e){de.value.VulNames=[],v.error("获取漏洞统计数据失败，请稍后重试")}finally{re.value=!1}}),300))},ve=a({}),fe=a([{field:"selection",type:"selection",minWidth:"55"},{field:"index",label:E("tableDemo.index"),type:"index",minWidth:55},{field:"url",label:"URL",minWidth:150},{field:"vulnerability",label:"Vulnerability",minWidth:120},{field:"level",label:"Level",minWidth:100,columnKey:"level",formatter:(e,t,l)=>{if(null==l)return i("div",null,null);const a="string"==typeof l?parseInt(l):l;let s="",o="";return 5===a?(s="red",o=E("poc.critical")):4===a?(s="orange",o=E("poc.high")):3===a?(s="yellow",o=E("poc.medium")):2===a?(s="blue",o=E("poc.low")):1===a?(s="green",o=E("poc.info")):0===a&&(s="gray",o=E("poc.unknown")),i(I,{gutter:20,style:"width: 80%"},{default:()=>[i(N,{span:1},{default:()=>[i(V,{icon:"clarity:circle-solid",color:s},null)]}),i(N,{span:5},{default:()=>[i(P,{type:"info"},ie(o)?o:{default:()=>[o]})]})]})},filters:[{text:E("poc.critical"),value:5},{text:E("poc.high"),value:4},{text:E("poc.medium"),value:3},{text:E("poc.low"),value:2},{text:E("poc.info"),value:1},{text:E("poc.unknown"),value:0}]},{field:"status",label:E("common.state"),minWidth:100,columnKey:"status",formatter:(e,t,l)=>{let a;null==e.status&&(e.status=1);const s=[{value:1,label:E("common.unprocessed")},{value:2,label:E("common.processing")},{value:3,label:E("common.ignored")},{value:4,label:E("common.suspected")},{value:5,label:E("common.confirmed")}];return i(T,{modelValue:e.status,"onUpdate:modelValue":async t=>{try{e.status=t,X(e.id,"vulnerability",t)}catch(l){}}},ie(a=s.map((e=>i(H,{key:e.value,label:e.label,value:e.value},null))))?a:{default:()=>[a]})},filters:[{text:E("common.unprocessed"),value:1},{text:E("common.processing"),value:2},{text:E("common.ignored"),value:3},{text:E("common.suspected"),value:4},{text:E("common.confirmed"),value:5}]},{field:"tags",label:"TAG",fit:"true",formatter:(e,t,a)=>{let i=[];if(null==a||""===a)i=[];else if("string"==typeof a)if(""===a.trim())i=[];else try{i=JSON.parse(a),Array.isArray(i)||(i=[a])}catch{i=a.split(",").map((e=>e.trim())).filter((e=>e.length>0))}else i=Array.isArray(a)?a:[];ve[e.id]||(ve[e.id]={inputVisible:!1,inputValue:"",inputRef:l(null)});const o=ve[e.id],n=async()=>{o.inputValue&&(i.push(o.inputValue),G(e.id,ge,o.inputValue)),o.inputVisible=!1,o.inputValue=""};return s(I,{},(()=>[...i.map((t=>s(N,{span:24,key:t},(()=>[s("div",{onClick:e=>((e,t)=>{e.target.classList.contains("el-tag__close")||qe("tags",t)})(e,t)},[s(A,{closable:!0,onClose:()=>(async t=>{const l=i.indexOf(t);l>-1&&i.splice(l,1),Q(e.id,ge,t)})(t)},(()=>t))])])))),s(N,{span:24},o.inputVisible?()=>s(f,{ref:o.inputRef,modelValue:o.inputValue,"onUpdate:modelValue":e=>o.inputValue=e,class:"w-20",size:"small",onKeyup:e=>{"Enter"===e.key&&n()},onBlur:n}):()=>s(g,{class:"button-new-tag",size:"small",onClick:()=>(o.inputVisible=!0,void h((()=>{})))},(()=>"+ New Tag")))]))},minWidth:"130"},{field:"time",label:E("asset.time"),minWidth:130},{field:"action",label:E("tableDemo.action"),formatter:(e,t,l)=>{let a;return i(r,null,[i(o,{type:"primary",onClick:()=>Ne(e)},ie(a=E("asset.detail"))?a:{default:()=>[a]}),i(o,{type:"success",onClick:()=>$e(e.vulnid)},{default:()=>[n("POC")]})])},minWidth:100}]);let ge="vulnerability";fe.forEach((e=>{e.hidden=e.hidden??!1}));const he=({field:e,hidden:t})=>{const l=fe.findIndex((t=>t.field===e));-1!==l&&(fe[l].hidden=t),(()=>{const e=fe.reduce(((e,t)=>(e[t.field]=t.hidden,e)),{});e.statisticsHidden=pe.value,localStorage.setItem(`columnConfig_${ge}`,JSON.stringify(e))})()};(()=>{const e=JSON.parse(localStorage.getItem(`columnConfig_${ge}`)||"{}");fe.forEach((t=>{void 0!==e[t.field]&&"select"!=t.field&&(t.hidden=e[t.field])})),pe.value=e.statisticsHidden})();const{allSchemas:ye}=$(fe),xe=a({});let be=!1;const{tableRegister:je,tableState:_e,tableMethods:we}=R({fetchDataApi:async()=>{if(be)return{list:[],total:0};be=!0;try{const{currentPage:e,pageSize:t}=_e,l=await B(oe.value,e.value,t.value,xe);return{list:l.data.list,total:l.data.total}}finally{be=!1}},immediate:!1}),{loading:Ve,dataList:Se,total:ke,currentPage:Ce,pageSize:Ee}=_e,{getList:Le,getElTableExpose:Re}=we;function ze(){return{background:"var(--el-fill-color-light)"}}Ee.value=20,u((()=>{L.projectId&&(xe.project=[L.projectId]),ce(),Ae(),window.addEventListener("resize",Ae)}));const Ue=l(0),Ae=()=>{const e=window.innerHeight||document.documentElement.clientHeight;Ue.value=.7*e},He=a({URL:"",Vulnerability:"",Level:"",Matched:"",Time:"",Request:"",Response:""}),Te=l(""),Ie=l(!1),Ne=e=>{const t=e.level,l="string"==typeof t?parseInt(t):t;Te.value="";let a="";5===l?(Te.value="red",a=E("poc.critical")):4===l?(Te.value="orange",a=E("poc.high")):3===l?(Te.value="yellow",a=E("poc.medium")):2===l?(Te.value="blue",a=E("poc.low")):1===l?(Te.value="green",a=E("poc.info")):0===l&&(Te.value="gray",a=E("poc.unknown")),He.Level=a,He.Vulnerability=e.vulnerability,He.Matched=e.matched,He.Time=e.time,He.URL=e.url,He.Request=e.request,He.Response=e.response,Ie.value=!0},De=async e=>{Object.assign(xe,e),Le(),ce()},Oe=(e,t)=>{Object.assign(xe,t),oe.value=e,Le(),ce()},Pe=l([]),qe=(e,t)=>{const l=`${e}=${t}`;Pe.value=[...Pe.value,l]},Fe=e=>{if(Pe.value){const[t,l]=e.split("=");t in xe&&Array.isArray(xe[t])&&(xe[t]=xe[t].filter((e=>e!==l)),0===xe[t].length&&delete xe[t]),Pe.value=Pe.value.filter((t=>t!==e)),Le(),ce()}};let We=a({id:"",name:"",level:"",content:"",tags:[]});const Me=l(!1),$e=async e=>{We.id="",We.name="",We.level="",We.content="",We.tags=[];const t=await Z(e);We.id=t.data.data.id,We.name=t.data.data.name,We.level=t.data.data.level,We.content=t.data.data.content,We.tags=t.data.data.tags,Me.value=!0},Be=()=>{Me.value=!1},Je=()=>xe;return(e,t)=>{const l=x("loading");return d(),p(r,null,[i(J,{getList:m(Le),handleSearch:ne,searchKeywordsData:se,index:"vulnerability",getElTableExpose:m(Re),handleFilterSearch:Oe,projectList:e.$props.projectList,crudSchemas:fe,dynamicTags:Pe.value,handleClose:Fe,onUpdateColumnVisibility:he,searchResultCount:m(ke),getFilter:Je},null,8,["getList","getElTableExpose","projectList","crudSchemas","dynamicTags","searchResultCount"]),i(m(I),null,{default:c((()=>[i(m(N),{span:pe.value?0:3},{default:c((()=>[y((d(),b(m(z),null,{default:c((()=>[i(m(q),{modelValue:ue.value,"onUpdate:modelValue":t[0]||(t[0]=e=>ue.value=e)},{default:c((()=>[i(m(F),{name:"1"},{title:c((()=>[i(m(P),{tag:"b",size:"small"},{default:c((()=>[n(S(m(E)("vulnerability.vulCounts")),1)])),_:1})])),default:c((()=>[i(m(j),{height:"20rem"},{default:c((()=>[0!==de.value.VulNames.length||re.value?_("",!0):(d(),p("div",ee,[i(m(V),{icon:"mdi:database-search",style:{"font-size":"32px","margin-bottom":"8px"}}),w("div",null,S(m(E)("common.noData")),1)])),(d(!0),p(r,null,k(de.value.VulNames,(e=>(d(),b(m(I),{key:e.value},{default:c((()=>[i(m(N),{span:12},{default:c((()=>[w("div",{onClick:t=>qe("vulname",e.value),class:"vul-tag-container",style:{cursor:"pointer"}},[i(m(A),{effect:"light",round:"",size:"small",class:"vul-tag",title:e.value},{default:c((()=>[n(S(e.value),1)])),_:2},1032,["title"])],8,te)])),_:2},1024),i(m(N),{span:12,style:{"text-align":"end"}},{default:c((()=>[i(m(P),{size:"small"},{default:c((()=>[n(S(e.number),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})),[[l,re.value]])])),_:1},8,["span"]),i(m(N),{span:pe.value?24:21},{default:c((()=>[i(m(z),null,{default:c((()=>[i(m(M),{pageSize:m(Ee),"onUpdate:pageSize":t[1]||(t[1]=e=>C(Ee)?Ee.value=e:null),currentPage:m(Ce),"onUpdate:currentPage":t[2]||(t[2]=e=>C(Ce)?Ce.value=e:null),columns:m(ye).tableColumns,data:m(Se),stripe:"",border:!0,"max-height":Ue.value,loading:m(Ve),resizable:!0,onRegister:m(je),onFilterChange:De,headerCellStyle:ze,style:{fontFamily:"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji"}},null,8,["pageSize","currentPage","columns","data","max-height","loading","onRegister"])])),_:1})])),_:1},8,["span"]),i(m(N),{span:24},{default:c((()=>[i(m(z),null,{default:c((()=>[i(m(U),{pageSize:m(Ee),"onUpdate:pageSize":t[3]||(t[3]=e=>C(Ee)?Ee.value=e:null),currentPage:m(Ce),"onUpdate:currentPage":t[4]||(t[4]=e=>C(Ce)?Ce.value=e:null),"page-sizes":[20,50,100,200,500,1e3],layout:"total, sizes, prev, pager, next, jumper",total:m(ke)},null,8,["pageSize","currentPage","total"])])),_:1})])),_:1})])),_:1}),i(m(W),{modelValue:Ie.value,"onUpdate:modelValue":t[5]||(t[5]=e=>Ie.value=e),title:m(E)("asset.detail"),center:"",style:{"border-radius":"15px","box-shadow":"5px 5px 10px rgba(0, 0, 0, 0.3)"},width:"70%","max-height":Ue.value},{default:c((()=>[i(m(D),{border:!0,column:2},{default:c((()=>[i(m(O),{label:"URL"},{default:c((()=>[n(S(He.URL),1)])),_:1}),i(m(O),{label:"Level",width:"100"},{default:c((()=>[i(m(V),{icon:"clarity:circle-solid",color:Te.value},null,8,["color"]),i(m(P),{type:"info"},{default:c((()=>[n(S(He.Level),1)])),_:1})])),_:1}),i(m(O),{label:"Vulnerability"},{default:c((()=>[n(S(He.Vulnerability),1)])),_:1}),i(m(O),{label:"Matched"},{default:c((()=>[n(S(He.Matched),1)])),_:1}),i(m(O),{label:"Time",span:2},{default:c((()=>[n(S(He.Time),1)])),_:1}),i(m(O),{label:"Request"},{default:c((()=>[i(m(j),{"max-height":Ue.value,"max-width":"maxHeight"},{default:c((()=>[w("div",le,S(He.Request),1)])),_:1},8,["max-height"])])),_:1}),i(m(O),{label:"Response"},{default:c((()=>[i(m(j),{"max-height":Ue.value},{default:c((()=>[w("div",ae,S(He.Response),1)])),_:1},8,["max-height"])])),_:1})])),_:1})])),_:1},8,["modelValue","title","max-height"]),i(m(W),{modelValue:Me.value,"onUpdate:modelValue":t[6]||(t[6]=e=>Me.value=e),title:m(We).id?e.$t("common.edit"):e.$t("common.new"),center:"",style:{"border-radius":"15px","box-shadow":"5px 5px 10px rgba(0, 0, 0, 0.3)"},maxHeight:800},{default:c((()=>[i(Y,{closeDialog:Be,pocForm:m(We),getList:m(Le)},null,8,["pocForm","getList"])])),_:1},8,["modelValue","title"])],64)}}}),[["__scopeId","data-v-b5db0ba7"]]);export{se as default};
