import{d as e,f as a,q as t,g as l,K as o,r as i,L as r,i as s,o as n,w as u,a as d,x as p,t as m,E as f,c,F as y,G as v,y as x,P as b}from"./index-CzUwgbbU.js";import{E as _,a as g}from"./el-tab-pane-BnyYsxQY.js";import{E as h,a as w}from"./el-form-CaL45Rkc.js";import{E as j,b as V}from"./el-radio-group-hM94gECG.js";import{E}from"./el-tag-uhvpNveH.js";import{E as C}from"./el-space-CJe1wr4F.js";import{E as S,a as T}from"./el-checkbox-BalLSeP9.js";/* empty css                          */import{r as k}from"./index-CyWn8tDN.js";import{_ as R}from"./Table.vue_vue_type_script_lang-BYQzrLxh.js";import{u as U}from"./useTable-J-LVShuT.js";const A=e=>k.post({url:"/api/export/delete",data:{ids:e}});function F(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!b(e)}const q=e({__name:"exportData",props:{index:{},searchParams:{},getFilter:{type:Function}},setup(e){const{t:b}=a(),q=e,N=t({type:"all",quantity:0}),P=async()=>{K.value=!0;const e=q.getFilter();await((e,a,t,l,o,i,r)=>k.post({url:"/api/export",data:{index:e,quantity:a,type:t,search:l,filter:o,field:i,filetype:r}}))(q.index,N.quantity,N.type,q.searchParams,e,oe.value,se.value),K.value=!1},B=t([{field:"selection",type:"selection"},{field:"file_name",label:b("export.fileName")},{field:"state",label:b("export.state"),formatter:(e,a,t)=>{if(0==t){let e;return l(E,{type:"info"},F(e=b("export.run"))?e:{default:()=>[e]})}if(1==t){let e;return l(E,{type:"success"},F(e=b("export.success"))?e:{default:()=>[e]})}{let e;return l(E,{type:"danger"},F(e=b("export.fail"))?e:{default:()=>[e]})}}},{field:"create_time",label:b("export.createTime")},{field:"end_time",label:b("export.endTime"),formatter:(e,a,t)=>""==t?"-":t},{field:"data_type",label:b("export.type")},{field:"file_size",label:b("export.fileSize"),formatter:(e,a,t)=>""==t?"-":t+" MB"},{field:"action",label:b("tableDemo.action"),fixed:"right",formatter:(e,a,t)=>{let i,r;return l("div",null,[l(o,{type:"success",onClick:()=>H(e.file_name)},F(i=b("export.download"))?i:{default:()=>[i]}),l(o,{type:"danger",onClick:()=>W(e)},F(r=b("common.delete"))?r:{default:()=>[r]})])}}]),{tableRegister:D,tableState:I,tableMethods:L}=U({fetchDataApi:async()=>({list:(await k.get({url:"/api/export/record"})).data.list}),immediate:!1}),{dataList:M,loading:z}=I,{getList:O,getElTableExpose:G}=L,H=async e=>{const a=document.createElement("a");a.href="/api/export/download?file_name="+e,a.click()},K=i(!1),Q=e=>{"exportRecords"==e&&O()},J=i(!1),W=async e=>{window.confirm("Are you sure you want to delete the selected data?")&&await X(e)},X=async e=>{J.value=!0;try{await A([e.file_name]);J.value=!1,O()}catch(a){J.value=!1,O()}},Y=async()=>{window.confirm("Are you sure you want to delete the selected data?")&&await $()},Z=i([]),$=async()=>{const e=await G(),a=(null==e?void 0:e.getSelectionRows())||[];Z.value=a.map((e=>e.file_name)),J.value=!0;try{await A(Z.value);J.value=!1,O()}catch(t){J.value=!1,O()}},ee=i([]),ae=async()=>{const e=await(a=q.index,k.post({url:"/api/getfield",data:{index:a}}));var a;ee.value=e.data.field};r((()=>{ae()}));const te=i(!0),le=i(!1),oe=i([]),ie=e=>{oe.value=e?ee.value:[],te.value=!1},re=e=>{const a=e.length;le.value=a===ee.value.length,te.value=a>0&&a<ee.value.length},se=i("csv");return(e,a)=>(n(),s(d(g),{tabPosition:"left",onTabChange:Q,"model-value":"export"},{default:u((()=>[l(d(_),{label:d(b)("asset.export"),name:"export"},{default:u((()=>[l(d(h),{model:N,"label-width":"auto",style:{position:"relative"}},{default:u((()=>[l(d(w),{label:d(b)("export.exportType")},{default:u((()=>[l(d(j),{modelValue:N.type,"onUpdate:modelValue":a[0]||(a[0]=e=>N.type=e)},{default:u((()=>[l(d(V),{value:"all"},{default:u((()=>[p(m(d(b)("export.exportTypeAll")),1)])),_:1}),l(d(V),{value:"search"},{default:u((()=>[p(m(d(b)("export.exportTypeSearch")),1)])),_:1})])),_:1},8,["modelValue"])])),_:1},8,["label"]),l(d(w),{label:d(b)("export.exportQuantity")},{default:u((()=>[l(d(f),{modelValue:N.quantity,"onUpdate:modelValue":a[1]||(a[1]=e=>N.quantity=e)},null,8,["modelValue"])])),_:1},8,["label"]),l(d(w),{label:d(b)("export.field")},{default:u((()=>[l(d(S),{modelValue:le.value,"onUpdate:modelValue":a[2]||(a[2]=e=>le.value=e),indeterminate:te.value,onChange:ie},{default:u((()=>[p(" All ")])),_:1},8,["modelValue","indeterminate"])])),_:1},8,["label"]),l(d(w),{label:" "},{default:u((()=>[l(d(T),{modelValue:oe.value,"onUpdate:modelValue":a[3]||(a[3]=e=>oe.value=e),onChange:re},{default:u((()=>[(n(!0),c(y,null,v(ee.value,(e=>(n(),s(d(S),{key:e,label:e,value:e},{default:u((()=>[p(m(e),1)])),_:2},1032,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),l(d(w),{label:d(b)("export.fileType")},{default:u((()=>[l(d(j),{modelValue:se.value,"onUpdate:modelValue":a[4]||(a[4]=e=>se.value=e)},{default:u((()=>[l(d(V),{value:"csv"},{default:u((()=>[p("csv")])),_:1}),l(d(V),{value:"json"},{default:u((()=>[p("json")])),_:1})])),_:1},8,["modelValue"])])),_:1},8,["label"]),l(d(w),null,{default:u((()=>[l(d(x),{type:"primary",onClick:P,style:{position:"relative",left:"40%"},loading:K.value},{default:u((()=>[p(" Create ")])),_:1},8,["loading"])])),_:1})])),_:1},8,["model"])])),_:1},8,["label"]),l(d(_),{label:d(b)("export.exportRecords"),name:"exportRecords"},{default:u((()=>[l(d(C),{direction:"vertical",alignment:"flex-start",style:{width:"100%"}},{default:u((()=>[l(d(o),{type:"danger",loading:J.value,onClick:Y},{default:u((()=>[p(m(d(b)("common.delete")),1)])),_:1},8,["loading"])])),_:1}),l(d(R),{onRegister:d(D),columns:B,data:d(M),loading:d(z),"max-height":"500",style:{fontFamily:"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji",width:"100%"}},null,8,["onRegister","columns","data","loading"])])),_:1},8,["label"])])),_:1}))}});export{q as _};
