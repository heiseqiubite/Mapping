import{d as e,f as l,H as a,u as t,r as s,J as i,z as o,B as n,c as u,o as r,h as c,A as d,g as m,w as p,x as v,a as f,C as h,Y as g,t as y,y as b,i as _,F as w,G as k,Z as j,$ as x,j as E,a0 as C,a1 as z,a2 as V,R as D,O,_ as U}from"./index-B3EiCo2S.js";import{E as $}from"./el-card-CrrcCGp_.js";import{E as B}from"./el-tag-B27ii0Fj.js";import{E as H}from"./el-link-CZSCbPWA.js";import{E as A,a as F}from"./el-table-column-D1qTPSN1.js";import"./el-checkbox-DISW8vgz.js";import"./el-tooltip-l0sNRNKZ.js";import"./el-popper-BVxf87sZ.js";import{E as I,a as L}from"./el-descriptions-item-DNgIcVGa.js";import{E as R}from"./el-divider-Bs0XUVOj.js";import{E as S}from"./el-empty-DcP8J_Rv.js";import{_ as q}from"./Dialog.vue_vue_type_style_index_0_lang-Chb3ii7l.js";import{g as J}from"./index-Bjtp2bC-.js";import{u as T,d as W}from"./index-DUOd3csz.js";import"./isArrayLikeObject-DH0T-Gqc.js";import"./index-DoD9gG_2.js";import"./debounce-BcWuyWDS.js";import"./raf-BaeSuW_0.js";import"./index-BG_6nwkU.js";import"./refs-BF7DfOff.js";import"./index-QUlrjjpt.js";const G={class:"vul-detail-container"},K={class:"back-button"},M={class:"card-header"},N={class:"title"},Y={key:0},Z={class:"vulnerability-name"},P={class:"vulnerability-stats"},Q={class:"url-cell"},X={class:"url-text"},ee={class:"time-cell"},le={class:"matched-cell"},ae={class:"action-buttons"},te={class:"code-block"},se={class:"code-block"},ie=U(e({__name:"VulDetail",setup(e){const{t:U}=l(),ie=a(),oe=t(),ne=ie.params.id,ue=s(null),re=s(!0),ce=s([]),de=s(!1),me=s(!1),pe=s(""),ve=s(""),fe=[{value:1,label:U("common.unprocessed")},{value:2,label:U("common.processing")},{value:3,label:U("common.ignored")},{value:4,label:U("common.suspected")},{value:5,label:U("common.confirmed")}],he=()=>{oe.go(-1)},ge=e=>{let l="",a="";return 5===e?(l="red",a=U("poc.critical")):4===e?(l="orange",a=U("poc.high")):3===e?(l="yellow",a=U("poc.medium")):2===e?(l="blue",a=U("poc.low")):1===e?(l="green",a=U("poc.info")):0===e&&(l="gray",a=U("poc.unknown")),{color:l,text:a}},ye=s(0),be=()=>{const e=window.innerHeight||document.documentElement.clientHeight;ye.value=.6*e};return i((()=>{be(),window.addEventListener("resize",be),(async()=>{try{re.value=!0;const e=await J(`id="${ne}"`,1,1,{});e.data.list&&e.data.list.length>0?(ue.value=e.data.list[0],ue.value.items&&ue.value.items.length>0?ce.value=ue.value.items.map(((e,l)=>{const a={...e};return a.id=`${ne}-item-${l}-${Date.now()}`,void 0!==a.status&&null!==a.status||(a.status=1),a})):ce.value=[]):(D.error(U("common.dataNotFound")),he())}catch(e){D.error(U("common.fetchFailed"))}finally{re.value=!1}})()})),(e,l)=>{const a=o("ElOption"),t=o("ElSelect"),s=n("loading");return r(),u("div",G,[c("div",K,[m(f(b),{type:"primary",plain:"",onClick:he},{default:p((()=>[m(f(h),null,{default:p((()=>[m(f(g))])),_:1}),v(" "+y(f(U)("common.back")),1)])),_:1})]),d((r(),_(f($),{class:"mb-4"},{header:p((()=>[c("div",M,[c("h3",N,y(f(U)("asset.vulDetail")),1)])])),default:p((()=>[ue.value?(r(),u("div",Y,[m(f(I),{column:2,border:""},{default:p((()=>[m(f(L),{label:f(U)("asset.vulnerability"),span:2},{default:p((()=>[c("span",Z,y(ue.value.vulnerability),1)])),_:1},8,["label"]),m(f(L),{label:f(U)("poc.level")},{default:p((()=>[m(f(B),{type:5===ue.value.level?"danger":4===ue.value.level||3===ue.value.level?"warning":2===ue.value.level?"info":1===ue.value.level?"success":"info",size:"large"},{default:p((()=>[v(y(ge(ue.value.level).text),1)])),_:1},8,["type"])])),_:1},8,["label"]),m(f(L),{label:f(U)("asset.count")},{default:p((()=>[v(y(ce.value.length),1)])),_:1},8,["label"])])),_:1}),m(f(R),null,{default:p((()=>[v(y(f(U)("asset.vulItems")),1)])),_:1}),c("div",P,[(r(),u(w,null,k(fe,(e=>m(f(B),{key:e.value,type:1===e.value?"warning":2===e.value?"info":3===e.value?"danger":4===e.value?"warning":"success",size:"small",class:"status-tag"},{default:p((()=>[v(y(e.label)+": "+y(ce.value.filter((l=>l.status===e.value)).length),1)])),_:2},1032,["type"]))),64))]),m(f(A),{data:ce.value,border:"",stripe:"",style:{width:"100%"},"max-height":ye.value,class:"custom-table mt-4","highlight-current-row":"","row-key":"id"},{default:p((()=>[m(f(F),{type:"selection",width:"55",align:"center"}),m(f(F),{type:"index",width:"50",align:"center",label:"序号"}),m(f(F),{prop:"url",label:"URL","min-width":"350","show-overflow-tooltip":"","class-name":"url-column",align:"left"},{default:p((({row:e})=>[c("div",Q,[m(f(H),{href:e.url,type:"primary",target:"_blank",underline:!1,class:"url-link"},{default:p((()=>[m(f(h),{class:"link-icon"},{default:p((()=>[m(f(j))])),_:1}),c("span",X,y(e.url),1)])),_:2},1032,["href"])])])),_:1}),m(f(F),{prop:"status",label:"状态",width:"200",align:"center"},{default:p((({row:e})=>[m(t,{modelValue:e.status,"onUpdate:modelValue":l=>e.status=l,size:"default",style:{width:"130px"},onChange:l=>(async(e,l)=>{try{await T(e.id,"vulnerability",l),e.status=l,D.success(U("common.updateSuccess"))}catch(a){D.error(U("common.updateError"))}})(e,l),class:"status-select"},{default:p((()=>[(r(),u(w,null,k(fe,(e=>m(a,{key:e.value,label:e.label,value:e.value},{default:p((()=>[m(f(B),{size:"small",type:1===e.value?"warning":2===e.value?"info":3===e.value?"danger":4===e.value?"warning":"success"},{default:p((()=>[v(y(e.label),1)])),_:2},1032,["type"])])),_:2},1032,["label","value"]))),64))])),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),m(f(F),{prop:"time",label:"发现时间",width:"300",align:"center"},{default:p((({row:e})=>[c("div",ee,[m(f(h),null,{default:p((()=>[m(f(x))])),_:1}),c("span",null,y(e.time),1)])])),_:1}),m(f(F),{prop:"matched",label:"匹配内容","min-width":"200","show-overflow-tooltip":""},{default:p((({row:e})=>[c("div",le,y(e.matched||"-"),1)])),_:1}),m(f(F),{label:"操作",width:"280",align:"center",fixed:"right"},{default:p((({row:e})=>[c("div",ae,[e.request?(r(),_(f(b),{key:0,size:"small",type:"primary",plain:"",onClick:l=>(e=>{pe.value=e.request,de.value=!0})(e)},{default:p((()=>[m(f(h),null,{default:p((()=>[m(f(C))])),_:1}),v(" 请求 ")])),_:2},1032,["onClick"])):E("",!0),e.response?(r(),_(f(b),{key:1,size:"small",type:"success",plain:"",onClick:l=>(e=>{ve.value=e.response,me.value=!0})(e)},{default:p((()=>[m(f(h),null,{default:p((()=>[m(f(z))])),_:1}),v(" 响应 ")])),_:2},1032,["onClick"])):E("",!0),m(f(b),{size:"small",type:"danger",plain:"",onClick:l=>(async e=>{e.id?O.confirm("Whether to delete?","Warning",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning"}).then((async()=>{try{const l=e.id;await W([l],"vulnerability"),D.success(U("common.deleteSuccess")),ce.value=ce.value.filter((l=>l.id!==e.id))}catch(l){D.error(U("common.deleteError"))}})).catch((()=>{D({type:"info",message:"Delete canceled"})})):D.warning(U("common.noId"))})(e)},{default:p((()=>[m(f(h),null,{default:p((()=>[m(f(V))])),_:1}),v(" 删除 ")])),_:2},1032,["onClick"])])])),_:1})])),_:1},8,["data","max-height"])])):(r(),_(f(S),{key:1,description:"暂无数据"}))])),_:1})),[[s,re.value]]),m(f(q),{modelValue:de.value,"onUpdate:modelValue":l[0]||(l[0]=e=>de.value=e),title:"请求详情",width:"60%"},{default:p((()=>[c("pre",te,y(pe.value),1)])),_:1},8,["modelValue"]),m(f(q),{modelValue:me.value,"onUpdate:modelValue":l[1]||(l[1]=e=>me.value=e),title:"响应详情",width:"60%"},{default:p((()=>[c("pre",se,y(ve.value),1)])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-93d8cbd0"]]);export{ie as default};
