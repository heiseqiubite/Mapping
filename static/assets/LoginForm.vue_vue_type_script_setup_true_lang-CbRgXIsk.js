import{u as e,F as t}from"./useForm-pL7f8RKM.js";import{d as a,e as o,V as s,m as r,u as n,f as l,q as i,g as d,F as u,r as c,K as m,L as p,S as g,a as f,i as w,o as b,P as v}from"./index-CzUwgbbU.js";import{E as R}from"./el-checkbox-BalLSeP9.js";import{l as y,g as h,a as x}from"./index-U3e2Tgk9.js";import{u as P}from"./useValidator-BQX7o_kI.js";const k=a({__name:"LoginForm",emits:["to-register"],setup(a,{emit:k}){const{required:I}=P(),j=o(),D=s(),E=r(),{currentRoute:F,addRoute:L,push:V}=n(),{t:q}=l(),A={username:[I()],password:[I()]},S=i([{field:"title",colProps:{span:24},formItemProps:{slots:{default:()=>d("h2",{class:"text-2xl font-light text-center w-[100%] tracking-wider text-gray-700 dark:text-gray-300"},[q("login.login")])}}},{field:"username",label:q("login.username"),component:"Input",colProps:{span:24},componentProps:{style:{"--el-input-border-color":"transparent","border-bottom":"1px solid #e2e8f0","border-radius":"0","padding-left":"0"}}},{field:"password",label:q("login.password"),component:"InputPassword",colProps:{span:24},componentProps:{style:{width:"100%","--el-input-border-color":"transparent","border-bottom":"1px solid #e2e8f0","border-radius":"0","padding-left":"0"}}},{field:"tool",colProps:{span:24},formItemProps:{slots:{default:()=>d(u,null,[d("div",{class:"flex justify-between items-center w-[100%]"},[d(R,{modelValue:_.value,"onUpdate:modelValue":e=>_.value=e,label:q("login.remember"),size:"small"},null)])])}}},{field:"login",colProps:{span:24},formItemProps:{slots:{default:()=>{let e;return d(u,null,[d("div",{class:"w-[100%]"},[d(m,{loading:K.value,type:"primary",class:"w-[100%] rounded-none py-6 tracking-wider",onClick:T},(t=e=q("login.login"),"function"==typeof t||"[object Object]"===Object.prototype.toString.call(t)&&!v(t)?e:{default:()=>[e]}))])]);var t}}}}]),_=c(D.getRememberMe);p((()=>{(()=>{const e=D.getLoginInfo;if(e){const{username:t,password:a}=e;U({username:t,password:a})}})()}));const{formRegister:M,formMethods:z}=e(),{getFormData:C,getElFormExpose:O,setValues:U}=z,K=c(!1),N=c("");g((()=>F.value),(e=>{var t;N.value=null==(t=null==e?void 0:e.query)?void 0:t.redirect}),{immediate:!0});const T=async()=>{const e=await O();await(null==e?void 0:e.validate((async e=>{if(e){K.value=!0;const e=await C();try{const t=await y(e);t&&(f(_)?D.setLoginInfo({username:e.username,password:e.password}):D.setLoginInfo(void 0),D.setRememberMe(f(_)),D.setToken(t.data.access_token),D.setUsername(e.username),j.getDynamicRouter?B():(await E.generateRoutes("static").catch((()=>{})),E.getAddRouters.forEach((e=>{L(e)})),E.setIsAddRouters(!0),V({path:N.value||E.addRouters[0].path})))}finally{K.value=!1}}})))},B=async()=>{const e={roleName:(await C()).username},t=j.getDynamicRouter&&j.getServerDynamicRouter?await h(e):await x(e);if(t){const e=t.data||[];D.setRoleRouters(e),j.getDynamicRouter&&j.getServerDynamicRouter?await E.generateRoutes("server",e).catch((()=>{})):await E.generateRoutes("frontEnd",e).catch((()=>{})),E.getAddRouters.forEach((e=>{L(e)})),E.setIsAddRouters(!0),V({path:N.value||E.addRouters[0].path})}};return(e,a)=>(b(),w(f(t),{schema:S,rules:A,"label-position":"top","hide-required-asterisk":"",size:"large",class:"dark:border-1 dark:border-[var(--el-border-color)] dark:border-solid",onRegister:f(M)},null,8,["schema","onRegister"]))}});export{k as _};
