import{ay as e,az as a,bv as t,bl as l,ch as s,al as o,d as r,ak as i,r as d,I as n,U as c,c as u,o as p,i as m,ar as v,aY as g,a as f,w as j,K as y,C as h,n as _,b5 as b,b4 as x,aM as k,f as w,u as C,h as z,g as E,F as S,G as P,dM as D,y as A,x as V,t as T,R as U,p as $,l as L,j as B,am as F,O as I,s as M,_ as R}from"./index-Bsz_-kew.js";import{E as q,a as N,b as O}from"./el-dropdown-item-CWLlQn2E.js";import"./el-popper-DexwxjEf.js";import{E as G}from"./el-pagination-C7pJ8QU5.js";import{E as K}from"./el-tag-BK85rvDV.js";import"./el-select-CsCiNFSq.js";import{E as W}from"./el-checkbox-C6S6n9Ra.js";import{E as H}from"./el-switch-DvKrBy-d.js";import{E as J,a as X}from"./el-form-BuXRuL0p.js";import{E as Y}from"./el-upload-DCvJcR77.js";import"./el-progress-CbnBXKe9.js";import{_ as Q}from"./Dialog.vue_vue_type_style_index_0_lang-CCL6sVJk.js";import{u as Z,d as ee}from"./index-Dd6OwE5S.js";import{_ as ae}from"./AddProject.vue_vue_type_script_setup_true_lang-D5uE0rtO.js";import{u as te}from"./useIcon-CR_HcNa1.js";import"./castArray-BltnW2TK.js";import"./refs-CimMBFwC.js";import"./index-I44EMqWl.js";import"./index-BS16aHrW.js";import"./strings-zWyb0xsZ.js";import"./debounce-Bd5c_m29.js";import"./index--g20Cokp.js";import"./index-DpC9HCFr.js";import"./el-divider-B98uacGM.js";import"./el-col-CstzfiNs.js";import"./el-tooltip-l0sNRNKZ.js";import"./el-radio-group-CszH4UBq.js";import"./el-virtual-list-Dx78Fvg-.js";import"./raf-CfAM2lGy.js";import"./el-select-v2-Bkw3mN9B.js";import"./el-input-number-ZDYKwCuy.js";import"./el-text-LCHv_yYZ.js";import"./index-DkjGGqJB.js";import"./index-DhTuOjm6.js";import"./DetailTemplate-D15bCnIS.js";import"./el-card-DHQ8n2iG.js";/* empty css                */import"./index-DfBP4C7Z.js";import"./index-kK6Ub8M_.js";const le=e({size:{type:[Number,String],values:s,default:"",validator:e=>l(e)},shape:{type:String,values:["circle","square"],default:"circle"},icon:{type:t},src:{type:String,default:""},alt:String,srcSet:String,fit:{type:a(String),default:"cover"}}),se={error:e=>e instanceof Event},oe=r({name:"ElAvatar"});const re=k(o(r({...oe,props:le,emits:se,setup(e,{emit:a}){const t=e,s=i("avatar"),o=d(!1),r=n((()=>{const{size:e,icon:a,shape:l}=t,o=[s.b()];return b(e)&&o.push(s.m(e)),a&&o.push(s.m("icon")),l&&o.push(s.m(l)),o})),k=n((()=>{const{size:e}=t;return l(e)?s.cssVarBlock({size:x(e)||""}):void 0})),w=n((()=>({objectFit:t.fit})));function C(e){o.value=!0,a("error",e)}return c((()=>t.src),(()=>o.value=!1)),(e,a)=>(p(),u("span",{class:_(f(r)),style:g(f(k))},[!e.src&&!e.srcSet||o.value?e.icon?(p(),m(f(h),{key:1},{default:j((()=>[(p(),m(y(e.icon)))])),_:1})):v(e.$slots,"default",{key:2}):(p(),u("img",{key:0,src:e.src,alt:e.alt,srcset:e.srcSet,style:g(f(w)),onError:C},null,44,["src","alt","srcset"]))],6))}}),[["__file","avatar.vue"]])),ie=e=>($("data-v-06020428"),e=e(),L(),e),de={class:"project-list"},ne={class:"project-grid"},ce=["onClick"],ue={class:"card-header"},pe={class:"avatar-container"},me={class:"card-body"},ve={class:"project-name"},ge={class:"project-tag"},fe={class:"project-stats"},je=ie((()=>z("data",null,null,-1))),ye={class:"pagination"},he={class:"upload-dialog-content"},_e=ie((()=>z("div",{class:"el-upload__text"},[V(" 将文件拖到此处，或"),z("em",null,"点击选择多个文件")],-1))),be=ie((()=>z("div",{class:"el-upload__tip"}," 支持选择多个 .dat 格式文件，单个文件不超过 50MB ",-1))),xe={class:"dialog-footer"},ke=R(r({__name:"ProjectList",props:{tableDataList:{type:Array,default:()=>[]},getProjectTag:{type:Function,required:!0},total:{type:Number,default:0},multipleSelection:{type:Boolean},selectedRows:{type:Array,default:()=>[]}},setup(e){const{t:a}=w(),{push:t}=C(),l=e;d(!1);let s="";const o=d(!1),r=()=>{o.value=!1},i=te({icon:"ep:edit"}),n=te({icon:"ep:delete"}),v=te({icon:"ep:data-analysis"}),g=te({icon:"ep:upload"}),y=d(!1),b=d(""),x=d(),k=d(!1),$=d({tag:"",files:[]}),L={tag:[{required:!0,message:"请输入项目标签",trigger:"blur"},{min:1,max:50,message:"标签长度应在 1 到 50 个字符",trigger:"blur"}]},R=async e=>{switch(e.type){case"edit":(async e=>{s=e,o.value=!0})(e.id);break;case"del":const r=d(!1);I({title:"Delete",draggable:!0,message:()=>M("div",{style:{display:"flex",alignItems:"center"}},[M("p",{style:{margin:"0 10px 0 0"}},a("task.delAsset")),M(H,{modelValue:r.value,"onUpdate:modelValue":e=>{r.value=e}})])}).then((async()=>{await ee([e.id],r.value),l.getProjectTag(1,50)}));break;case"aggregation":t(`/project-management/project-detail?id=${e.id}`);break;case"upload":b.value=e.id,y.value=!0}},le=(e,a)=>{$.value.files=[],a.forEach((e=>{const a=e.raw;if(!a)return;if(a.size>52428800)return void U.error(`文件 ${a.name} 大小不能超过 50MB`);const t=a.name.toLowerCase();[".dat"].some((e=>t.endsWith(e)))?$.value.files.push(a):U.error(`文件 ${a.name} 仅支持 .dat 格式`)}))},se=(e,a)=>{$.value.files=[],a.forEach((e=>{const a=e.raw;a&&$.value.files.push(a)}))},oe=async()=>{x.value&&await x.value.validate((async e=>{if(e)if(0!==$.value.files.length)try{k.value=!0;const e=await Z(b.value,$.value.files);if(200!==e.code)throw new Error(e.message||"上传失败");U.success(`成功上传 ${$.value.files.length} 个文件！`),ie(),l.getProjectTag(ke.value,we.value)}catch(a){U.error(a.message||"上传失败，请重试")}finally{k.value=!1}else U.error("请选择要上传的文件")}))},ie=()=>{var e;y.value=!1,$.value.tag="",$.value.files=[],null==(e=x.value)||e.resetFields()},ke=d(1),we=d(50),Ce=d(!1),ze=d(!0),Ee=d(!1),Se=()=>{l.getProjectTag(ke.value,we.value)},Pe=d([]);c((()=>l.selectedRows),(e=>{Pe.value=e})),c((()=>l.tableDataList),(e=>{De.value=Pe.value.length===e.length}));const De=d(!1);return(d,c)=>(p(),u("div",de,[z("div",ne,[(p(!0),u(S,null,P(e.tableDataList,(l=>(p(),u("div",{key:l.id,class:"project-card"},[z("div",{class:"card-content",onClick:e=>{return a=l.id,void t(`/project-management/project-detail?id=${a}`);var a}},[z("div",ue,[e.multipleSelection?(p(),m(f(W),{key:0,value:Pe.value.includes(l.id),onClick:F((e=>((e,a)=>{e.preventDefault(),e.stopPropagation();const t=Pe.value.indexOf(a);-1===t?Pe.value.push(a):Pe.value.splice(t,1)})(e,l.id)),["stop"]),class:"checkbox"},null,8,["value","onClick"])):B("",!0),z("div",pe,[l.logo?(p(),m(f(re),{key:0,src:l.logo,class:"avatar",fit:"cover"},null,8,["src"])):(p(),m(f(re),{key:1,class:"avatar avatar-placeholder"},{default:j((()=>[V(T(l.name.charAt(0).toUpperCase()),1)])),_:2},1024))])]),z("div",me,[z("h3",ve,T(l.name),1),z("div",ge,[E(f(K),{size:"small",effect:"plain"},{default:j((()=>[V(T(l.tag),1)])),_:2},1024)]),z("div",fe,[E(f(h),null,{default:j((()=>[je])),_:1}),z("span",null,T(f(a)("project.totalAssets"))+": "+T(l.AssetCount),1)])])],8,ce),E(f(O),{trigger:"contextmenu",onCommand:R,class:"card-dropdown"},{dropdown:j((()=>[E(f(q),null,{default:j((()=>[E(f(N),{icon:f(i),command:{type:"edit",id:l.id}},{default:j((()=>[V(T(f(a)("common.edit")),1)])),_:2},1032,["icon","command"]),E(f(N),{icon:f(n),command:{type:"del",id:l.id}},{default:j((()=>[V(T(f(a)("common.delete")),1)])),_:2},1032,["icon","command"]),E(f(N),{icon:f(g),command:{type:"upload",id:l.id}},{default:j((()=>[V(T(f(a)("common.uplaod")),1)])),_:2},1032,["icon","command"]),E(f(N),{icon:f(v),command:{type:"aggregation",id:l.id}},{default:j((()=>[V(T(f(a)("project.aggregation")),1)])),_:2},1032,["icon","command"])])),_:2},1024)])),default:j((()=>[z("div",{class:"dropdown-trigger",onClick:c[0]||(c[0]=F((()=>{}),["stop"]))})])),_:2},1024)])))),128))]),z("div",ye,[E(f(G),{"current-page":ke.value,"onUpdate:currentPage":c[1]||(c[1]=e=>ke.value=e),"page-size":we.value,"onUpdate:pageSize":c[2]||(c[2]=e=>we.value=e),"page-sizes":[50,70,100,200,400],small:Ce.value,disabled:Ee.value,background:ze.value,layout:"total, sizes, prev, pager, next, jumper",total:e.total,onSizeChange:Se,onCurrentChange:Se},null,8,["current-page","page-size","small","disabled","background","total"])]),E(f(Q),{modelValue:o.value,"onUpdate:modelValue":c[3]||(c[3]=e=>o.value=e),title:f(a)("common.edit"),center:"",style:{"border-radius":"15px","box-shadow":"5px 5px 10px rgb(0 0 0 / 30%)"}},{default:j((()=>[E(ae,{closeDialog:r,projectid:f(s),getProjectData:l.getProjectTag,schedule:!1},null,8,["projectid","getProjectData"])])),_:1},8,["modelValue","title"]),E(f(Q),{modelValue:y.value,"onUpdate:modelValue":c[4]||(c[4]=e=>y.value=e),title:f(a)("common.upload"),center:"","max-height":"300",width:"40%",style:{"border-radius":"15px","box-shadow":"5px 5px 10px rgb(0 0 0 / 30%)",position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)"},"append-to-body":!0},{default:j((()=>[z("div",he,[E(f(J),{ref_key:"uploadFormRef",ref:x,model:$.value,rules:L,"label-width":"80px",class:"upload-form"},{default:j((()=>[E(f(X),{label:"选择文件",prop:"files"},{default:j((()=>[E(f(Y),{class:_(["file-upload",{"has-files":$.value.files.length>0}]),drag:"","auto-upload":!1,"on-change":le,"on-remove":se,"show-file-list":!0,limit:10,accept:".dat",multiple:""},{tip:j((()=>[be])),default:j((()=>[E(f(h),{class:"el-icon--upload"},{default:j((()=>[E(f(D))])),_:1}),_e])),_:1},8,["class"])])),_:1})])),_:1},8,["model"]),z("div",xe,[E(f(A),{onClick:ie},{default:j((()=>[V("取消")])),_:1}),E(f(A),{type:"primary",loading:k.value,onClick:oe,disabled:0===$.value.files.length},{default:j((()=>[V(T(k.value?"上传中...":"开始上传"+($.value.files.length>0?`(${$.value.files.length}个文件)`:"")),1)])),_:1},8,["loading","disabled"])])])])),_:1},8,["modelValue","title"])]))}}),[["__scopeId","data-v-06020428"]]);export{ke as default};
