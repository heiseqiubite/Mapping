import{_ as e}from"./ContentWrap.vue_vue_type_script_setup_true_lang-DaYN3Raa.js";import{r as t,I as a,H as l,d as o,f as s,q as i,U as n,c as r,o as c,F as p,g as d,a as u,w as m,i as g,j as v,h as f,t as h,y,x,P as _,C as j,X as b,G as k,n as w,O as S,R as C,_ as V}from"./index-Bsz_-kew.js";import{a as H,E as F}from"./el-col-CstzfiNs.js";import{E as T,a as $}from"./el-table-column-CDjS8A0j.js";import"./el-checkbox-C6S6n9Ra.js";import"./el-tooltip-l0sNRNKZ.js";import"./el-popper-DexwxjEf.js";import{E}from"./el-tag-BK85rvDV.js";import{E as A}from"./el-text-LCHv_yYZ.js";import{E as L}from"./el-divider-B98uacGM.js";import{E as U}from"./el-autocomplete-aHpLnkvK.js";import{b as z,E as D,a as I}from"./el-dropdown-item-CWLlQn2E.js";import"./el-select-CsCiNFSq.js";/* empty css                */import{E as R}from"./el-tree-select-BLWE9X0m.js";import{E as B}from"./el-switch-DvKrBy-d.js";import{_ as O}from"./Dialog.vue_vue_type_style_index_0_lang-CCL6sVJk.js";import{u as P}from"./useIcon-CR_HcNa1.js";import{_ as q}from"./exportData.vue_vue_type_script_setup_true_lang-BDjNv10t.js";import{d as N,A as J}from"./index-COM1-P1v.js";import{_ as K}from"./AddTask.vue_vue_type_script_setup_true_lang-BrY7O3Hl.js";import"./el-card-DHQ8n2iG.js";import"./isArrayLikeObject-DvVlT94e.js";import"./index-BS16aHrW.js";import"./debounce-Bd5c_m29.js";import"./raf-CfAM2lGy.js";import"./index-I44EMqWl.js";import"./el-pagination-C7pJ8QU5.js";import"./castArray-BltnW2TK.js";import"./refs-CimMBFwC.js";import"./strings-zWyb0xsZ.js";import"./index--g20Cokp.js";import"./index-J8gc4mN7.js";import"./el-tab-pane-WnKWzXw4.js";import"./el-form-BuXRuL0p.js";import"./el-radio-group-CszH4UBq.js";import"./el-space-Bk13ttH_.js";/* empty css                          */import"./index-DpC9HCFr.js";import"./Table.vue_vue_type_script_lang-DEQW24mX.js";import"./el-image-viewer-D8G6B48i.js";import"./el-empty-IOBAAoiF.js";import"./tsxHelper-D30aWQ_5.js";import"./index-CVJINu6s.js";import"./useTable-DOsThTKn.js";import"./el-virtual-list-Dx78Fvg-.js";import"./el-select-v2-Bkw3mN9B.js";import"./index-DkjGGqJB.js";import"./index-DhTuOjm6.js";import"./DetailTemplate-D15bCnIS.js";import"./index-DfBP4C7Z.js";import"./index-kK6Ub8M_.js";import"./index-Dd6OwE5S.js";const W={style:{float:"left"}},M={style:{float:"right","font-size":"13px",color:"var(--el-text-color-secondary)"}},G={class:"custom-dropdown"},Q={key:0,class:"dropdown-item"},X={class:"label-text"},Y={class:"label-text"},Z={class:"segment-control"},ee={class:"flex gap-2"},te={style:{color:"#888"}},ae={style:{"font-weight":"bold",color:"#333"}},le={style:{color:"#888"}},oe=V(o({__name:"Csearch",props:{getList:{type:Function},handleSearch:{type:Function},searchKeywordsData:{},index:{},getElTableExpose:{type:Function},handleFilterSearch:{type:Function},projectList:{},dynamicTags:{},handleClose:{type:Function},openAggregation:{type:Function},crudSchemas:{},statisticsHidden:{type:Boolean},changeStatisticsHidden:{type:Function},searchResultCount:{},activeSegment:{},setActiveSegment:{type:Function},getFilter:{type:Function}},emits:["update-column-visibility"],setup(o,{emit:V}){const{t:oe}=s(),{query:se}=l(),ie=o,ne=i([...ie.searchKeywordsData]),re={keyword:"task",example:'task=="test"',explain:oe("searchHelp.taskName")};ne.push(re),ne.push({keyword:"tag",example:'tag=="test"',explain:"find tags"});const ce=[{operator:"=",meaning:oe("searchHelp.like"),value:'=""'},{operator:"!=",meaning:oe("searchHelp.notIn"),value:'!=""'},{operator:"==",meaning:oe("searchHelp.equal"),value:'==""'}],pe=[{operator:"&&",meaning:oe("searchHelp.and"),value:"&&",logic:"1"},{operator:"||",meaning:oe("searchHelp.or"),value:"||",logic:"1"},{operator:"()",meaning:oe("searchHelp.brackets"),value:"()",logic:"1"}],de=ce.concat(pe),ue=t(!1);(()=>{const e=JSON.parse(localStorage.getItem(`columnConfig_${ie.index}`)||"{}");ie.crudSchemas.forEach((t=>{void 0!==e[t.field]&&(t.hidden=e[t.field])}))})(),n((()=>ie.crudSchemas),(()=>{(()=>{const e=ie.crudSchemas.reduce(((e,t)=>("select"!=t.field&&(e[t.field]=t.hidden),e)),{});localStorage.setItem(`columnConfig_${ie.index}`,JSON.stringify(e))})()}),{deep:!0});const me=()=>{ue.value=!0};function ge(){return{background:"var(--el-fill-color-light)"}}const ve=t(""),fe=P({icon:"iconoir:search"}),he=P({icon:"tdesign:chat-bubble-help"}),ye=P({icon:"ri:arrow-drop-down-line"}),xe=P({icon:"ph:export-light"}),_e=P({icon:"carbon:data-vis-1"}),je=P({icon:"openmoji:delete"}),be=P({icon:"carbon:task-complete"}),ke=t(!1),we=()=>{ke.value=!0},Se=t([]),Ce=async()=>{var e;const t=await ie.getElTableExpose(),a=(null==(e=null==t?void 0:t.getSelectionRows)?void 0:e.call(t))||[];return Se.value=a.map((e=>e.id)),Se.value},Ve=async()=>{S.confirm("Whether to delete?","Warning",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning"}).then((async()=>{await Ce(),await N(Se.value,ie.index),ie.getList()})).catch((()=>{C({type:"info",message:"Delete canceled"})}))},He=async()=>{const e=`确定要删除所有 ${ie.searchResultCount} 条搜索结果吗？此操作不可恢复！`;S.confirm(e,"危险操作",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"error",dangerouslyUseHTMLString:!0}).then((async()=>{const e=ie.getFilter();await J(ve.value,e,ie.index),ie.getList(),C({type:"success",message:"删除成功"})})).catch((()=>{C({type:"info",message:"已取消删除"})}))},Fe=t(""),Te=t(!1),$e=t(!1);let Ee=t(!0),Ae=t(!1),Le=t(!1);const Ue=(e,t)=>{if(Fe.value=e,""==e&&(Ee.value=!0,Le.value=!1,Ae.value=!1),Ee.value){Le.value&&(e=e.replace(Fe.value,"").trim());t(ne.filter((t=>t.keyword.toLowerCase().includes(e.toLowerCase()))))}else if(Ae.value){const a=e.replace(Fe.value,"").trim();t(ce.filter((e=>e.operator.includes(a))))}else if(Le.value&&e.endsWith(" ")){const a=e.replace(ve.value,"").trim();t(pe.filter((e=>e.operator.includes(a))))}else t([])},ze=e=>{if(e.keyword){let t="";t=Le.value?Fe.value+e.keyword:e.keyword,Fe.value=t,ve.value=t,Te.value=!0,Ee.value=!1,Ae.value=!0}else e.logic?(ve.value=`${Fe.value}${e.value}`,Fe.value=ve.value,Ee.value=!0):(ve.value=`${Fe.value}${e.value}`,Fe.value=ve.value,$e.value=!0,Ae.value=!1,Le.value=!0)},De=t(!1),{projectValue:Ie}=function(){const e=l(),o=t([]);return{projectValue:a({get:()=>{if(o.value.length>0)return o.value;const t=e.query.id;return t?[t]:[]},set:e=>{o.value=e}}),userSelectedProjects:o}}();n((()=>Ie.value),(e=>{(async()=>{ie.handleFilterSearch(ve.value,{project:Ie.value})})()}));const Re=t(ie.dynamicTags?[...ie.dynamicTags]:[]),Be=()=>{const e={};Re.value.forEach((t=>{const[a,l]=t.split("=");a in e?e[a].push(l):e[a]=[l]})),e.project=Ie.value,ie.handleFilterSearch(ve.value,e)};let Oe=se.task;void 0!==Oe&&""!==Oe&&Re.value.push(`task=${Oe}`);const Pe=JSON.parse(localStorage.getItem("assetActiveSegment")||"{}");Pe&&Pe.activeSegment&&ie.setActiveSegment&&ie.setActiveSegment(Pe.activeSegment,!1),Be(),n((()=>ie.dynamicTags),(e=>{e?(Re.value=[...e],void 0!==Oe&&""!==Oe&&Re.value.push(`task=${Oe}`)):Re.value=[],Be()}),{immediate:!1});const qe=V,Ne=t(ie.statisticsHidden),Je=()=>{location.reload()},Ke=P({icon:"icons8:insert-table"}),We=P({icon:"flowbite:grid-solid"});function Me(e){ie.setActiveSegment&&ie.setActiveSegment(e,!0)}const Ge=t(!1);let Qe=oe("task.addTask");const Xe=()=>{Ge.value=!1},Ye=async()=>{await Ce(),Ge.value=!0};return(t,a)=>(c(),r(p,null,[d(u(e),null,{default:m((()=>[d(u(H),{class:"row-bg",gutter:20},{default:m((()=>[d(u(F),{span:6},{default:m((()=>[d(u(U),{modelValue:ve.value,"onUpdate:modelValue":a[0]||(a[0]=e=>ve.value=e),"fetch-suggestions":Ue,placeholder:u(oe)("form.input"),popperClass:"my-autocomplete",onSelect:ze,style:{width:"100%"}},{append:m((()=>[d(u(y),{onClick:me,text:"",style:{display:"contents"},icon:u(he)},null,8,["icon"])])),default:m((({item:e})=>[f("span",W,h(e.keyword||e.operator),1),f("span",M,h(e.explain||e.meaning),1)])),_:1},8,["modelValue","placeholder"])])),_:1}),d(u(F),{span:1.5},{default:m((()=>[d(u(y),{type:"primary",icon:u(fe),onClick:a[1]||(a[1]=e=>t.$props.handleSearch(ve.value))},{default:m((()=>[x(h(u(oe)("form.input")),1)])),_:1},8,["icon"])])),_:1}),d(u(F),{span:1.5},{default:m((()=>[d(u(y),{type:"primary",onClick:we,icon:u(xe)},{default:m((()=>[x(h(u(oe)("asset.export")),1)])),_:1},8,["icon"])])),_:1}),d(u(F),{span:4},{default:m((()=>[d(u(R),{loading:De.value,modelValue:u(Ie),"onUpdate:modelValue":a[2]||(a[2]=e=>_(Ie)?Ie.value=e:null),data:t.$props.projectList,placeholder:u(oe)("project.project"),multiple:"",filterable:"","show-checkbox":""},null,8,["loading","modelValue","data","placeholder"])])),_:1}),d(u(F),{span:1.5,xs:1.5,sm:1.5,md:1.5},{default:m((()=>[d(u(z),{trigger:"click"},{dropdown:m((()=>[d(u(D),null,{default:m((()=>[d(u(I),{icon:u(je),onClick:Ve},{default:m((()=>[x(h(u(oe)("common.delete")),1)])),_:1},8,["icon"]),d(u(I),{icon:u(je),onClick:He},{default:m((()=>[x(h(u(oe)("common.deleteAll"))+" ("+h(ie.searchResultCount)+") ",1)])),_:1},8,["icon"]),d(u(I),{icon:u(be),onClick:Ye},{default:m((()=>[x(h(u(oe)("task.addTask")),1)])),_:1},8,["icon"])])),_:1})])),default:m((()=>[d(u(y),{plain:"",class:"custom-button align-bottom"},{default:m((()=>[x(h(u(oe)("common.operation"))+" ",1),d(u(j),{class:"el-icon--right"},{default:m((()=>[d(u(ye))])),_:1})])),_:1})])),_:1})])),_:1}),d(u(F),{span:1,style:{display:"flex","align-items":"center"}},{default:m((()=>[d(u(z),null,{dropdown:m((()=>[d(u(D),null,{default:m((()=>[(c(!0),r(p,null,k(t.crudSchemas,((e,t)=>(c(),g(u(I),{key:t},{default:m((()=>["selection"!=e.field?(c(),r("div",Q,[f("span",X,h(e.label),1),d(u(B),{size:"small",modelValue:e.hidden,"onUpdate:modelValue":t=>e.hidden=t,"active-value":!1,"inactive-value":!0,onChange:t=>(e=>{qe("update-column-visibility",{field:e.field,hidden:e.hidden})})(e)},null,8,["modelValue","onUpdate:modelValue","onChange"])])):v("",!0)])),_:2},1024)))),128)),"asset"==t.$props.index?(c(),g(u(I),{key:0},{default:m((()=>[f("span",Y,h(u(oe)("asset.Chart")),1),d(u(B),{size:"small",modelValue:Ne.value,"onUpdate:modelValue":a[3]||(a[3]=e=>Ne.value=e),"active-value":!1,"inactive-value":!0,onChange:a[4]||(a[4]=e=>{return t=Ne.value,void(ie.changeStatisticsHidden&&ie.changeStatisticsHidden(t));var t})},null,8,["modelValue"])])),_:1})):v("",!0),d(u(I),{divided:""},{default:m((()=>[d(u(y),{style:{width:"100%"},type:"primary",onClick:Je},{default:m((()=>[x("Save")])),_:1})])),_:1})])),_:1})])),default:m((()=>[f("div",G,[d(u(b),{icon:"ant-design:setting-outlined",class:"cursor-pointer"})])])),_:1})])),_:1}),"asset"==t.index?(c(),g(u(F),{key:0,span:2,style:{display:"flex","align-items":"center"}},{default:m((()=>[f("div",Z,[f("div",{class:w(["segment",{active:"tableSegment"===ie.activeSegment}]),onClick:a[5]||(a[5]=e=>Me("tableSegment"))},[d(u(j),null,{default:m((()=>[d(u(Ke))])),_:1})],2),f("div",{class:w(["segment",{active:"cardSegment"===ie.activeSegment}]),onClick:a[6]||(a[6]=e=>Me("cardSegment"))},[d(u(j),null,{default:m((()=>[d(u(We))])),_:1})],2)])])),_:1})):v("",!0),d(u(F),{span:2,xs:2,sm:2,md:2},{default:m((()=>["SensitiveResult"==t.index?(c(),g(u(y),{key:0,type:"success",onClick:t.$props.openAggregation,icon:u(_e)},{default:m((()=>[x(h(u(oe)("project.aggregation")),1)])),_:1},8,["onClick","icon"])):v("",!0)])),_:1})])),_:1}),d(u(H),{style:{"margin-top":"10px"}},{default:m((()=>[d(u(F),{span:24},{default:m((()=>[f("div",ee,[f("span",te,h(u(oe)("asset.total")),1),f("span",ae,h(ie.searchResultCount),1),f("span",le,h(u(oe)("asset.result")),1),(c(!0),r(p,null,k(Re.value,(e=>(c(),g(u(E),{key:e,closable:"","disable-transitions":!1,type:"info",size:"small",onClose:t=>function(e){e.includes("task=")&&(Oe=""),ie.handleClose&&ie.handleClose(e)}(e)},{default:m((()=>[x(h(e),1)])),_:2},1032,["onClose"])))),128))])])),_:1})])),_:1})])),_:1}),d(u(O),{modelValue:ue.value,"onUpdate:modelValue":a[7]||(a[7]=e=>ue.value=e),title:u(oe)("common.querysyntax"),center:"",style:{"border-radius":"15px","box-shadow":"5px 5px 10px rgb(0 0 0 / 30%)",position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)"},"append-to-body":!0},{default:m((()=>[d(u(H),null,{default:m((()=>[d(u(F),null,{default:m((()=>[d(u(A),{tag:"b",size:"small"},{default:m((()=>[x(h(u(oe)("searchHelp.operator")),1)])),_:1}),d(u(L),{direction:"vertical"}),d(u(A),{size:"small",type:"danger"},{default:m((()=>[x(h(u(oe)("searchHelp.notice")),1)])),_:1})])),_:1}),d(u(F),{style:{"margin-top":"10px"}},{default:m((()=>[d(u(T),{headerCellStyle:ge,data:u(de)},{default:m((()=>[d(u($),{prop:"operator",label:u(oe)("searchHelp.operator"),width:"300"},null,8,["label"]),d(u($),{prop:"meaning",label:u(oe)("searchHelp.meaning")},null,8,["label"])])),_:1},8,["data"])])),_:1}),d(u(F),{style:{"margin-top":"15px"}},{default:m((()=>[d(u(A),{tag:"b",size:"small"},{default:m((()=>[x(h(u(oe)("searchHelp.keywords")),1)])),_:1})])),_:1}),d(u(F),{style:{"margin-top":"10px"}},{default:m((()=>[d(u(T),{headerCellStyle:ge,data:ne},{default:m((()=>[d(u($),{prop:"keyword",label:u(oe)("searchHelp.keywords")},null,8,["label"]),d(u($),{prop:"example",label:u(oe)("searchHelp.example")},null,8,["label"]),d(u($),{prop:"explain",label:u(oe)("searchHelp.explain")},null,8,["label"])])),_:1},8,["data"])])),_:1})])),_:1})])),_:1},8,["modelValue","title"]),d(u(O),{modelValue:ke.value,"onUpdate:modelValue":a[8]||(a[8]=e=>ke.value=e),title:u(oe)("asset.export"),center:"","max-height":"300",width:"70%",style:{"border-radius":"15px","box-shadow":"5px 5px 10px rgb(0 0 0 / 30%)",position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)"},"append-to-body":!0},{default:m((()=>[d(q,{index:t.$props.index,searchParams:ve.value,getFilter:t.$props.getFilter},null,8,["index","searchParams","getFilter"])])),_:1},8,["modelValue","title"]),d(u(O),{modelValue:Ge.value,"onUpdate:modelValue":a[9]||(a[9]=e=>Ge.value=e),title:u(Qe),center:"",width:"70%",style:{"border-radius":"15px","box-shadow":"5px 5px 10px rgb(0 0 0 / 30%)",position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)"},"append-to-body":!0},{default:m((()=>[d(K,{closeDialog:Xe,create:!0,taskid:"",schedule:!1,getList:function(){},tp:t.$props.index+"Source","target-ids":Se.value,getFilter:t.$props.getFilter,searchParams:ve.value},null,8,["getList","tp","target-ids","getFilter","searchParams"])])),_:1},8,["modelValue","title"])],64))}}),[["__scopeId","data-v-6e89b3e3"]]);export{oe as default};
