import{_ as e}from"./ContentWrap.vue_vue_type_script_setup_true_lang-DaYN3Raa.js";import{d as a,f as l,r as t,q as o,g as i,s as n,M as s,F as r,O as u,J as p,W as c,c as d,o as m,w as g,a as f,y,C as v,N as h,h as b,x,t as _,E as j,z as F,P as S,V as k,j as w,R as C,Q as A}from"./index-Bsz_-kew.js";import{a as E,E as V}from"./el-col-CstzfiNs.js";import{E as U}from"./el-text-LCHv_yYZ.js";import{E as B}from"./el-tag-BK85rvDV.js";import"./el-tooltip-l0sNRNKZ.js";import{E as D}from"./el-popper-DexwxjEf.js";import{E as z}from"./el-upload-DCvJcR77.js";import"./el-progress-CbnBXKe9.js";import{E as P,a as I,b as L}from"./el-dropdown-item-CWLlQn2E.js";import{_ as H}from"./Table.vue_vue_type_script_lang-DEQW24mX.js";import{u as R}from"./useTable-DOsThTKn.js";import{u as W}from"./useIcon-CR_HcNa1.js";import{_ as T}from"./Dialog.vue_vue_type_style_index_0_lang-CCL6sVJk.js";import{d as M,g as O,u as N,r as J,a as $,b as q,e as K,c as Q}from"./index-DfBP4C7Z.js";import X from"./detail-D9QiMVvl.js";import"./el-card-DHQ8n2iG.js";import"./index-I44EMqWl.js";import"./index-BS16aHrW.js";import"./el-pagination-C7pJ8QU5.js";import"./el-select-CsCiNFSq.js";import"./strings-zWyb0xsZ.js";import"./castArray-BltnW2TK.js";import"./debounce-Bd5c_m29.js";import"./index--g20Cokp.js";import"./refs-CimMBFwC.js";import"./el-table-column-CDjS8A0j.js";import"./isArrayLikeObject-DvVlT94e.js";import"./el-checkbox-C6S6n9Ra.js";import"./raf-CfAM2lGy.js";import"./el-image-viewer-D8G6B48i.js";import"./el-empty-IOBAAoiF.js";import"./tsxHelper-D30aWQ_5.js";import"./index-CVJINu6s.js";import"./index-DpC9HCFr.js";import"./el-form-BuXRuL0p.js";import"./index-BuCXGCts.js";const G={class:"flex flex-wrap gap-3 items-center"},Y={href:"https://plugin.scope-sentry.top/",target:"_blank"},Z={style:{position:"relative",top:"12px"}},ee={key:0},ae={class:"flex flex-col gap-2"};function le(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!A(e)}const te=a({__name:"plugin",setup(a){const A=W({icon:"iconoir:search"}),{t:te}=l(),oe=t(""),ie=()=>{ye()},ne=o([{field:"index",label:te("tableDemo.index"),type:"index",minWidth:"15"},{field:"selection",type:"selection",minWidth:55},{field:"name",label:te("plugin.name"),formatter:(e,a,l)=>i("a",{href:`https://plugin.scope-sentry.top/plugin/${e.hash}`,style:"color: #409EFF; text-decoration: none;",target:"_blank"},[l])},{field:"module",label:te("plugin.module"),formatter:(e,a,l)=>{const t=se[l]||"#FFFFFF";return i(B,{style:{backgroundColor:t,color:"#000"}},le(l)?l:{default:()=>[l]})}},{field:"isSystem",label:te("plugin.isSystem"),formatter:(e,a,l)=>i(B,{type:l?"success":"warning"},{default:()=>[l?"true":"false"]})},{field:"version",label:te("plugin.version"),minWidth:100},{field:"parameter",label:te("plugin.parameter"),formatter:(e,a,l)=>i(D,{content:e.help,placement:"top",effect:"light"},{default:()=>[i("span",{style:"cursor: pointer;"},[l])]})},{field:"introduction",label:te("plugin.introduction"),minWidth:200},{field:"action",label:te("tableDemo.action"),minWidth:"300",fixed:"right",formatter:(e,a,l)=>{let t,o,u;const p=n(L,{onCommand:a=>{switch(a){case"reinstall":$("all",e.hash,e.module);break;case"recheck":J("all",e.hash,e.module);break;case"uninstall":N("all",e.hash,e.module)}}},{default:()=>n(y,{style:{outline:"none",boxShadow:"none"}},(()=>[te("common.operation"),n(v,{},(()=>n(h)))])),dropdown:()=>n(P,null,(()=>[n(I,{command:"reinstall"},(()=>te("plugin.reInstall"))),n(I,{command:"recheck"},(()=>te("plugin.reCheck"))),n(I,{command:"uninstall"},(()=>te("plugin.uninstall")))]))});return i(r,null,[p,i(s,{type:"warning",style:{marginLeft:"10px"},onClick:()=>He(e)},le(t=te("common.log"))?t:{default:()=>[t]}),i(s,{type:"success",onClick:()=>Ee(e.id)},le(o=te("common.edit"))?o:{default:()=>[o]}),i(s,{type:"danger",onClick:()=>Fe(e.hash,e.module),disabled:e.isSystem},le(u=te("common.delete"))?u:{default:()=>[u]})])}}]),se={TargetHandler:"#2243dda6",SubdomainScan:"#FF9B85",SubdomainSecurity:"#FFFFBA",PortScanPreparation:"#BAFFB3",PortScan:"#BAE1FF",AssetMapping:"#e3ffba",URLScan:"#D1BAFF",WebCrawler:"#FFABAB",DirScan:"#3ccde6",VulnerabilityScan:"#FF677D",AssetHandle:"#B2E1FF",PortFingerprint:"#ffb5e4",URLSecurity:"#FFE4BA",PassiveScan:"#A2DFF7"},{tableRegister:re,tableState:ue,tableMethods:pe}=R({fetchDataApi:async()=>{const{currentPage:e,pageSize:a}=ue,l=await q(oe.value,e.value,a.value);return{list:l.data.list,total:l.data.total}},immediate:!0}),{loading:ce,dataList:de,total:me,currentPage:ge,pageSize:fe}=ue;fe.value=20;const{getList:ye,getElTableExpose:ve}=pe;function he(){return{background:"var(--el-fill-color-light)"}}const be=t(!1);let xe=te("plugin.new");const _e=()=>{be.value=!1},je=async()=>{u({title:"Delete",draggable:!0}).then((async()=>{await we()}))},Fe=async(e,a)=>{u({title:"Delete",draggable:!0}).then((async()=>{await ke(e,a)}))},Se=t(!1),ke=async(e,a)=>{Se.value=!0;try{await M([{hash:e,module:a}]);Se.value=!1,ye()}catch(l){Se.value=!1,ye()}},we=async()=>{const e=await ve(),a=((null==e?void 0:e.getSelectionRows())||[]).map((e=>({hash:e.hash,module:e.module})));Se.value=!0;try{await M(a);Se.value=!1,ye()}catch(l){Se.value=!1,ye()}},Ce=async()=>{Ae.value="",be.value=!0},Ae=t(""),Ee=async e=>{Ae.value=e,xe=te("common.edit"),be.value=!0};p((()=>{Ue(),window.addEventListener("resize",Ue)}));const Ve=t(0),Ue=()=>{const e=window.innerHeight||document.documentElement.clientHeight;Ve.value=.7*e},Be=t(!1),De=()=>{Be.value=!1},ze=t(""),Pe=t(),Ie=t(""),Le=t(""),He=async e=>{Ie.value=e.module,Le.value=e.hash;const a=await O(e.module,e.hash);ze.value=a.logs,Be.value=!0},Re=async()=>{await K(Ie.value,Le.value),ze.value=""},We={Authorization:`${c().getToken}`},Te=t(),Me=e=>{Te.value.clearFiles();const a=e[0];Te.value.handleStart(a)},Oe=e=>{var a;200===e.code?C.success("Upload succes"):C.error(e.message),505==e.code&&localStorage.removeItem("plugin_key"),ye(),null==(a=Te.value)||a.clearFiles()},Ne=(e,a)=>{a.length>0&&Te.value.submit()},Je=t(!1),$e=t(""),qe=async()=>{if($e.value){200==(await Q($e.value)).code&&(localStorage.setItem("plugin_key",$e.value),Je.value=!1)}};return(()=>{const e=localStorage.getItem("plugin_key");e||(Je.value=!0),$e.value=e})(),(a,l)=>{const t=F("Icon");return m(),d(r,null,[i(f(e),null,{default:g((()=>[i(f(E),null,{default:g((()=>[i(f(V),{span:1},{default:g((()=>[i(f(U),{class:"mx-1",style:{position:"relative",top:"8px"}},{default:g((()=>[x(_(f(te)("plugin.name"))+":",1)])),_:1})])),_:1}),i(f(V),{span:5},{default:g((()=>[i(f(j),{modelValue:oe.value,"onUpdate:modelValue":l[0]||(l[0]=e=>oe.value=e),placeholder:f(te)("common.inputText"),style:{height:"38px"}},null,8,["modelValue","placeholder"])])),_:1}),i(f(V),{span:5,style:{position:"relative",left:"16px"}},{default:g((()=>[i(f(y),{type:"primary",icon:f(A),style:{height:"100%"},onClick:ie},{default:g((()=>[x("Search")])),_:1},8,["icon"])])),_:1})])),_:1}),i(f(E),{gutter:16,class:"mt-4"},{default:g((()=>[i(f(V),{xs:24,sm:24,md:24,lg:24,xl:24},{default:g((()=>[b("div",G,[i(f(s),{type:"primary",onClick:Ce},{default:g((()=>[x(_(f(te)("plugin.new")),1)])),_:1}),i(f(s),{type:"danger",loading:Se.value,onClick:je},{default:g((()=>[x(_(f(te)("plugin.delete")),1)])),_:1},8,["loading"]),b("a",Y,[i(f(s),{type:"info"},{default:g((()=>[x(_(f(te)("plugin.market")),1)])),_:1})]),i(f(z),{ref_key:"upload",ref:Te,class:"flex items-center",action:"/api/plugin/import?key="+$e.value,headers:We,"on-success":Oe,limit:1,"on-exceed":Me,"auto-upload":!1,onChange:Ne},{trigger:g((()=>[i(f(s),null,{icon:g((()=>[i(t,{icon:"iconoir:upload"})])),default:g((()=>[x(" "+_(f(te)("plugin.import")),1)])),_:1})])),_:1},8,["action"])])])),_:1})])),_:1}),b("div",Z,[i(f(H),{pageSize:f(fe),"onUpdate:pageSize":l[1]||(l[1]=e=>S(fe)?fe.value=e:null),currentPage:f(ge),"onUpdate:currentPage":l[2]||(l[2]=e=>S(ge)?ge.value=e:null),columns:ne,data:f(de),stripe:"",border:!0,loading:f(ce),resizable:!0,pagination:{total:f(me),pageSizes:[20,30,50,100,200,500,1e3]},onRegister:f(re),headerCellStyle:he,style:{fontFamily:"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji"}},null,8,["pageSize","currentPage","columns","data","loading","pagination","onRegister"])])])),_:1}),i(f(T),{modelValue:be.value,"onUpdate:modelValue":l[3]||(l[3]=e=>be.value=e),title:f(xe),center:"",style:{"border-radius":"15px","box-shadow":"5px 5px 10px rgb(0 0 0 / 30%)"}},{default:g((()=>[i(X,{closeDialog:_e,getList:f(ye),id:Ae.value},null,8,["getList","id"])])),_:1},8,["modelValue","title"]),i(f(T),{modelValue:Be.value,"onUpdate:modelValue":l[4]||(l[4]=e=>Be.value=e),title:f(te)("node.log"),center:"",style:{"border-radius":"15px","box-shadow":"5px 5px 10px rgb(0 0 0 / 30%)"},maxHeight:Ve.value},{footer:g((()=>[i(f(s),{onClick:Re,type:"danger"},{default:g((()=>[x(_(f(te)("common.cleanLog")),1)])),_:1}),i(f(s),{onClick:De},{default:g((()=>[x(_(f(te)("common.off")),1)])),_:1})])),default:g((()=>[i(f(k),{ref_key:"scrollbarRef",ref:Pe},{default:g((()=>[ze.value?(m(),d("pre",ee,_(ze.value),1)):w("",!0)])),_:1},512)])),_:1},8,["modelValue","title","maxHeight"]),i(f(T),{modelValue:Je.value,"onUpdate:modelValue":l[6]||(l[6]=e=>Je.value=e),title:f(te)("plugin.key"),center:"",width:"30%",style:{height:"200px","max-width":"400px"}},{default:g((()=>[b("div",ae,[i(f(D),{class:"item",effect:"dark",content:f(te)("plugin.keyMsg"),placement:"top"},{default:g((()=>[i(f(j),{modelValue:$e.value,"onUpdate:modelValue":l[5]||(l[5]=e=>$e.value=e)},null,8,["modelValue"])])),_:1},8,["content"]),i(f(s),{onClick:qe,type:"primary",class:"w-full"},{default:g((()=>[x("确定")])),_:1})])])),_:1},8,["modelValue","title"])],64)}}});export{te as default};
