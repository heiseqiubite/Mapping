import{cX as e,a7 as a,aa as t,ad as s,ae as n,ak as l,d as o,bD as i,dC as r,dD as c,aK as u,af as d,c2 as f,r as v,dE as m,ba as p,I as g,U as b,J as k,bF as w,i as y,o as x,w as h,g as I,T as C,h as _,aw as z,n as O,a as N,c3 as T,j as A,c as R,al as E,ar as L,C as Y,bk as $,F as X,bw as F,am as S,x as D,t as P,dF as M,cG as j,K as B,dG as G,dH as W,G as K,dI as H,aW as J,a3 as V,at as q}from"./index-B3EiCo2S.js";import{E as U}from"./index-BG_6nwkU.js";import{d as Z}from"./debounce-BcWuyWDS.js";function Q(a,t,s){var n=!0,l=!0;if("function"!=typeof a)throw new TypeError("Expected a function");return e(s)&&(n="leading"in s?!!s.leading:n,l="trailing"in s?!!s.trailing:l),Z(a,t,{leading:n,maxWait:t,trailing:l})}const ee=t({urlList:{type:s(Array),default:()=>n([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:{type:Boolean,default:!1},crossorigin:{type:s(String)}}),ae={close:()=>!0,switch:e=>a(e),rotate:e=>a(e)},te=o({name:"ElImageViewer"});const se=q(l(o({...te,props:ee,emits:ae,setup(e,{expose:a,emit:t}){var s;const n=e,l={CONTAIN:{name:"contain",icon:i(c)},ORIGINAL:{name:"original",icon:i(r)}};let o,q="";const{t:Z}=u(),ee=d("image-viewer"),{nextZIndex:ae}=f(),te=v(),se=v([]),ne=m(),le=v(!0),oe=v(n.initialIndex),ie=p(l.CONTAIN),re=v({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),ce=v(null!=(s=n.zIndex)?s:ae()),ue=g((()=>{const{urlList:e}=n;return e.length<=1})),de=g((()=>0===oe.value)),fe=g((()=>oe.value===n.urlList.length-1)),ve=g((()=>n.urlList[oe.value])),me=g((()=>[ee.e("btn"),ee.e("prev"),ee.is("disabled",!n.infinite&&de.value)])),pe=g((()=>[ee.e("btn"),ee.e("next"),ee.is("disabled",!n.infinite&&fe.value)])),ge=g((()=>{const{scale:e,deg:a,offsetX:t,offsetY:s,enableTransition:n}=re.value;let o=t/e,i=s/e;const r=a*Math.PI/180,c=Math.cos(r),u=Math.sin(r);o=o*c+i*u,i=i*c-t/e*u;const d={transform:`scale(${e}) rotate(${a}deg) translate(${o}px, ${i}px)`,transition:n?"transform .3s":""};return ie.value.name===l.CONTAIN.name&&(d.maxWidth=d.maxHeight="100%"),d})),be=g((()=>`${oe.value+1} / ${n.urlList.length}`));function ke(){ne.stop(),null==o||o(),document.body.style.overflow=q,t("close")}function we(){le.value=!1}function ye(e){le.value=!1,e.target.alt=Z("el.image.error")}function xe(e){if(le.value||0!==e.button||!te.value)return;re.value.enableTransition=!1;const{offsetX:a,offsetY:t}=re.value,s=e.pageX,n=e.pageY,l=Q((e=>{re.value={...re.value,offsetX:a+e.pageX-s,offsetY:t+e.pageY-n}})),o=w(document,"mousemove",l);w(document,"mouseup",(()=>{o()})),e.preventDefault()}function he(){re.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function Ie(){if(le.value)return;const e=H(l),a=Object.values(l),t=ie.value.name,s=(a.findIndex((e=>e.name===t))+1)%e.length;ie.value=l[e[s]],he()}function Ce(e){const a=n.urlList.length;oe.value=(e+a)%a}function _e(){de.value&&!n.infinite||Ce(oe.value-1)}function ze(){fe.value&&!n.infinite||Ce(oe.value+1)}function Oe(e,a={}){if(le.value)return;const{minScale:s,maxScale:l}=n,{zoomRate:o,rotateDeg:i,enableTransition:r}={zoomRate:n.zoomRate,rotateDeg:90,enableTransition:!0,...a};switch(e){case"zoomOut":re.value.scale>s&&(re.value.scale=Number.parseFloat((re.value.scale/o).toFixed(3)));break;case"zoomIn":re.value.scale<l&&(re.value.scale=Number.parseFloat((re.value.scale*o).toFixed(3)));break;case"clockwise":re.value.deg+=i,t("rotate",re.value.deg);break;case"anticlockwise":re.value.deg-=i,t("rotate",re.value.deg)}re.value.enableTransition=r}function Ne(e){var a;"pointer"===(null==(a=e.detail)?void 0:a.focusReason)&&e.preventDefault()}function Te(){n.closeOnPressEscape&&ke()}function Ae(e){if(e.ctrlKey)return e.deltaY<0||e.deltaY>0?(e.preventDefault(),!1):void 0}return b(ve,(()=>{V((()=>{const e=se.value[0];(null==e?void 0:e.complete)||(le.value=!0)}))})),b(oe,(e=>{he(),t("switch",e)})),k((()=>{!function(){const e=Q((e=>{switch(e.code){case J.esc:n.closeOnPressEscape&&ke();break;case J.space:Ie();break;case J.left:_e();break;case J.up:Oe("zoomIn");break;case J.right:ze();break;case J.down:Oe("zoomOut")}})),a=Q((e=>{Oe((e.deltaY||e.deltaX)<0?"zoomIn":"zoomOut",{zoomRate:n.zoomRate,enableTransition:!1})}));ne.run((()=>{w(document,"keydown",e),w(document,"wheel",a)}))}(),o=w("wheel",Ae,{passive:!1}),q=document.body.style.overflow,document.body.style.overflow="hidden"})),a({setActiveItem:Ce}),(e,a)=>(x(),y(N(U),{to:"body",disabled:!e.teleported},{default:h((()=>[I(C,{name:"viewer-fade",appear:""},{default:h((()=>[_("div",{ref_key:"wrapper",ref:te,tabindex:-1,class:O(N(ee).e("wrapper")),style:z({zIndex:ce.value})},[I(N(T),{loop:"",trapped:"","focus-trap-el":te.value,"focus-start-el":"container",onFocusoutPrevented:Ne,onReleaseRequested:Te},{default:h((()=>[_("div",{class:O(N(ee).e("mask")),onClick:L((a=>e.hideOnClickModal&&ke()),["self"])},null,10,["onClick"]),A(" CLOSE "),_("span",{class:O([N(ee).e("btn"),N(ee).e("close")]),onClick:ke},[I(N(Y),null,{default:h((()=>[I(N($))])),_:1})],2),A(" ARROW "),N(ue)?A("v-if",!0):(x(),R(X,{key:0},[_("span",{class:O(N(me)),onClick:_e},[I(N(Y),null,{default:h((()=>[I(N(F))])),_:1})],2),_("span",{class:O(N(pe)),onClick:ze},[I(N(Y),null,{default:h((()=>[I(N(S))])),_:1})],2)],64)),e.$slots.progress||e.showProgress?(x(),R("div",{key:1,class:O([N(ee).e("btn"),N(ee).e("progress")])},[E(e.$slots,"progress",{activeIndex:oe.value,total:e.urlList.length},(()=>[D(P(N(be)),1)]))],2)):A("v-if",!0),A(" ACTIONS "),_("div",{class:O([N(ee).e("btn"),N(ee).e("actions")])},[_("div",{class:O(N(ee).e("actions__inner"))},[E(e.$slots,"toolbar",{actions:Oe,prev:_e,next:ze,reset:Ie,activeIndex:oe.value,setActiveItem:Ce},(()=>[I(N(Y),{onClick:e=>Oe("zoomOut")},{default:h((()=>[I(N(M))])),_:1},8,["onClick"]),I(N(Y),{onClick:e=>Oe("zoomIn")},{default:h((()=>[I(N(j))])),_:1},8,["onClick"]),_("i",{class:O(N(ee).e("actions__divider"))},null,2),I(N(Y),{onClick:Ie},{default:h((()=>[(x(),y(B(N(ie).icon)))])),_:1}),_("i",{class:O(N(ee).e("actions__divider"))},null,2),I(N(Y),{onClick:e=>Oe("anticlockwise")},{default:h((()=>[I(N(G))])),_:1},8,["onClick"]),I(N(Y),{onClick:e=>Oe("clockwise")},{default:h((()=>[I(N(W))])),_:1},8,["onClick"])]))],2)],2),A(" CANVAS "),_("div",{class:O(N(ee).e("canvas"))},[(x(!0),R(X,null,K(e.urlList,((a,t)=>(x(),R(X,{key:t},[t===oe.value?(x(),R("img",{key:0,ref_for:!0,ref:e=>se.value[t]=e,src:a,style:z(N(ge)),class:O(N(ee).e("img")),crossorigin:e.crossorigin,onLoad:we,onError:ye,onMousedown:xe},null,46,["src","crossorigin"])):A("v-if",!0)],64)))),128))],2),E(e.$slots,"default")])),_:3},8,["focus-trap-el"])],6)])),_:3})])),_:3},8,["disabled"]))}}),[["__file","image-viewer.vue"]]));export{se as E};
