import{aa as e,ad as a,an as t,a7 as l,ch as s,ak as o,d as r,af as i,r as d,I as n,U as c,c as u,o as p,i as m,al as v,aw as g,a as f,w as j,K as y,C as h,n as _,a8 as x,bb as b,at as k,f as w,u as C,h as E,g as S,F as z,G as P,dM as D,y as A,x as V,t as T,R as U,p as $,l as L,j as B,ar as F,O as I,s as R,_ as q}from"./index-B3EiCo2S.js";import{E as M,a as N,b as O}from"./el-dropdown-item-D01yRie3.js";import"./el-popper-BVxf87sZ.js";import{E as G}from"./el-pagination-BrC_eYrZ.js";import{E as K}from"./el-tag-B27ii0Fj.js";import"./el-select-CY6LOZx-.js";import{E as W}from"./el-checkbox-DISW8vgz.js";import{E as H}from"./el-switch-CNw4GHOB.js";import{E as J,a as X}from"./el-form-BuBNySiR.js";import{E as Q}from"./el-upload-C2ca_cBE.js";import"./el-progress-dMr12y8C.js";import{_ as Y}from"./Dialog.vue_vue_type_style_index_0_lang-Chb3ii7l.js";import{u as Z,d as ee}from"./index-CUwJOcjC.js";import{_ as ae}from"./AddProject.vue_vue_type_script_setup_true_lang-C5XVP7F0.js";import{u as te}from"./useIcon-BB0QiO3L.js";import"./castArray-BI5HMQaJ.js";import"./refs-BF7DfOff.js";import"./index-BG_6nwkU.js";import"./index-DoD9gG_2.js";import"./strings-BciOnfsg.js";import"./debounce-BcWuyWDS.js";import"./index-DjN3fv7d.js";import"./index-QUlrjjpt.js";import"./el-divider-Bs0XUVOj.js";import"./el-col-DtKbKOG8.js";import"./el-tooltip-l0sNRNKZ.js";import"./el-radio-group-CEHGycv7.js";import"./el-virtual-list-Cb286V6z.js";import"./raf-BaeSuW_0.js";import"./el-select-v2-Dup29apw.js";import"./el-input-number-DMRAGITy.js";import"./el-text-CmnqunHf.js";import"./index-DUjuAl0C.js";import"./index-BGQZL4Fw.js";import"./DetailTemplate-CjMfz7vP.js";import"./el-card-CrrcCGp_.js";/* empty css                */import"./index-jOLBrEFX.js";import"./index-DlJhDMIn.js";const le=e({size:{type:[Number,String],values:s,default:"",validator:e=>l(e)},shape:{type:String,values:["circle","square"],default:"circle"},icon:{type:t},src:{type:String,default:""},alt:String,srcSet:String,fit:{type:a(String),default:"cover"}}),se={error:e=>e instanceof Event},oe=r({name:"ElAvatar"});const re=k(o(r({...oe,props:le,emits:se,setup(e,{emit:a}){const t=e,s=i("avatar"),o=d(!1),r=n((()=>{const{size:e,icon:a,shape:l}=t,o=[s.b()];return x(e)&&o.push(s.m(e)),a&&o.push(s.m("icon")),l&&o.push(s.m(l)),o})),k=n((()=>{const{size:e}=t;return l(e)?s.cssVarBlock({size:b(e)||""}):void 0})),w=n((()=>({objectFit:t.fit})));function C(e){o.value=!0,a("error",e)}return c((()=>t.src),(()=>o.value=!1)),(e,a)=>(p(),u("span",{class:_(f(r)),style:g(f(k))},[!e.src&&!e.srcSet||o.value?e.icon?(p(),m(f(h),{key:1},{default:j((()=>[(p(),m(y(e.icon)))])),_:1})):v(e.$slots,"default",{key:2}):(p(),u("img",{key:0,src:e.src,alt:e.alt,srcset:e.srcSet,style:g(f(w)),onError:C},null,44,["src","alt","srcset"]))],6))}}),[["__file","avatar.vue"]])),ie=e=>($("data-v-06020428"),e=e(),L(),e),de={class:"project-list"},ne={class:"project-grid"},ce=["onClick"],ue={class:"card-header"},pe={class:"avatar-container"},me={class:"card-body"},ve={class:"project-name"},ge={class:"project-tag"},fe={class:"project-stats"},je=ie((()=>E("data",null,null,-1))),ye={class:"pagination"},he={class:"upload-dialog-content"},_e=ie((()=>E("div",{class:"el-upload__text"},[V(" 将文件拖到此处，或"),E("em",null,"点击选择多个文件")],-1))),xe=ie((()=>E("div",{class:"el-upload__tip"}," 支持选择多个 .dat 格式文件，单个文件不超过 50MB ",-1))),be={class:"dialog-footer"},ke=q(r({__name:"ProjectList",props:{tableDataList:{type:Array,default:()=>[]},getProjectTag:{type:Function,required:!0},total:{type:Number,default:0},multipleSelection:{type:Boolean},selectedRows:{type:Array,default:()=>[]}},setup(e){const{t:a}=w(),{push:t}=C(),l=e;d(!1);let s="";const o=d(!1),r=()=>{o.value=!1},i=te({icon:"ep:edit"}),n=te({icon:"ep:delete"}),v=te({icon:"ep:data-analysis"}),g=te({icon:"ep:upload"}),y=d(!1),x=d(""),b=d(),k=d(!1),$=d({tag:"",files:[]}),L={tag:[{required:!0,message:"请输入项目标签",trigger:"blur"},{min:1,max:50,message:"标签长度应在 1 到 50 个字符",trigger:"blur"}]},q=async e=>{switch(e.type){case"edit":(async e=>{s=e,o.value=!0})(e.id);break;case"del":const r=d(!1);I({title:"Delete",draggable:!0,message:()=>R("div",{style:{display:"flex",alignItems:"center"}},[R("p",{style:{margin:"0 10px 0 0"}},a("task.delAsset")),R(H,{modelValue:r.value,"onUpdate:modelValue":e=>{r.value=e}})])}).then((async()=>{await ee([e.id],r.value),l.getProjectTag(1,50)}));break;case"aggregation":t(`/project-management/project-detail?id=${e.id}`);break;case"upload":x.value=e.id,y.value=!0}},le=(e,a)=>{$.value.files=[],a.forEach((e=>{const a=e.raw;if(!a)return;if(a.size>52428800)return void U.error(`文件 ${a.name} 大小不能超过 50MB`);const t=a.name.toLowerCase();[".dat"].some((e=>t.endsWith(e)))?$.value.files.push(a):U.error(`文件 ${a.name} 仅支持 .dat 格式`)}))},se=(e,a)=>{$.value.files=[],a.forEach((e=>{const a=e.raw;a&&$.value.files.push(a)}))},oe=async()=>{b.value&&await b.value.validate((async e=>{if(e)if(0!==$.value.files.length)try{k.value=!0;const e=await Z(x.value,$.value.files);if(200!==e.code)throw new Error(e.message||"上传失败");U.success(`成功上传 ${$.value.files.length} 个文件！`),ie(),l.getProjectTag(ke.value,we.value)}catch(a){U.error(a.message||"上传失败，请重试")}finally{k.value=!1}else U.error("请选择要上传的文件")}))},ie=()=>{var e;y.value=!1,$.value.tag="",$.value.files=[],null==(e=b.value)||e.resetFields()},ke=d(1),we=d(50),Ce=d(!1),Ee=d(!0),Se=d(!1),ze=()=>{l.getProjectTag(ke.value,we.value)},Pe=d([]);c((()=>l.selectedRows),(e=>{Pe.value=e})),c((()=>l.tableDataList),(e=>{De.value=Pe.value.length===e.length}));const De=d(!1);return(d,c)=>(p(),u("div",de,[E("div",ne,[(p(!0),u(z,null,P(e.tableDataList,(l=>(p(),u("div",{key:l.id,class:"project-card"},[E("div",{class:"card-content",onClick:e=>{return a=l.id,void t(`/project-management/project-detail?id=${a}`);var a}},[E("div",ue,[e.multipleSelection?(p(),m(f(W),{key:0,value:Pe.value.includes(l.id),onClick:F((e=>((e,a)=>{e.preventDefault(),e.stopPropagation();const t=Pe.value.indexOf(a);-1===t?Pe.value.push(a):Pe.value.splice(t,1)})(e,l.id)),["stop"]),class:"checkbox"},null,8,["value","onClick"])):B("",!0),E("div",pe,[l.logo?(p(),m(f(re),{key:0,src:l.logo,class:"avatar",fit:"cover"},null,8,["src"])):(p(),m(f(re),{key:1,class:"avatar avatar-placeholder"},{default:j((()=>[V(T(l.name.charAt(0).toUpperCase()),1)])),_:2},1024))])]),E("div",me,[E("h3",ve,T(l.name),1),E("div",ge,[S(f(K),{size:"small",effect:"plain"},{default:j((()=>[V(T(l.tag),1)])),_:2},1024)]),E("div",fe,[S(f(h),null,{default:j((()=>[je])),_:1}),E("span",null,T(f(a)("project.totalAssets"))+": "+T(l.AssetCount),1)])])],8,ce),S(f(O),{trigger:"contextmenu",onCommand:q,class:"card-dropdown"},{dropdown:j((()=>[S(f(M),null,{default:j((()=>[S(f(N),{icon:f(i),command:{type:"edit",id:l.id}},{default:j((()=>[V(T(f(a)("common.edit")),1)])),_:2},1032,["icon","command"]),S(f(N),{icon:f(n),command:{type:"del",id:l.id}},{default:j((()=>[V(T(f(a)("common.delete")),1)])),_:2},1032,["icon","command"]),S(f(N),{icon:f(g),command:{type:"upload",id:l.id}},{default:j((()=>[V(T(f(a)("common.uplaod")),1)])),_:2},1032,["icon","command"]),S(f(N),{icon:f(v),command:{type:"aggregation",id:l.id}},{default:j((()=>[V(T(f(a)("project.aggregation")),1)])),_:2},1032,["icon","command"])])),_:2},1024)])),default:j((()=>[E("div",{class:"dropdown-trigger",onClick:c[0]||(c[0]=F((()=>{}),["stop"]))})])),_:2},1024)])))),128))]),E("div",ye,[S(f(G),{"current-page":ke.value,"onUpdate:currentPage":c[1]||(c[1]=e=>ke.value=e),"page-size":we.value,"onUpdate:pageSize":c[2]||(c[2]=e=>we.value=e),"page-sizes":[50,70,100,200,400],small:Ce.value,disabled:Se.value,background:Ee.value,layout:"total, sizes, prev, pager, next, jumper",total:e.total,onSizeChange:ze,onCurrentChange:ze},null,8,["current-page","page-size","small","disabled","background","total"])]),S(f(Y),{modelValue:o.value,"onUpdate:modelValue":c[3]||(c[3]=e=>o.value=e),title:f(a)("common.edit"),center:"",style:{"border-radius":"15px","box-shadow":"5px 5px 10px rgb(0 0 0 / 30%)"}},{default:j((()=>[S(ae,{closeDialog:r,projectid:f(s),getProjectData:l.getProjectTag,schedule:!1},null,8,["projectid","getProjectData"])])),_:1},8,["modelValue","title"]),S(f(Y),{modelValue:y.value,"onUpdate:modelValue":c[4]||(c[4]=e=>y.value=e),title:f(a)("common.upload"),center:"","max-height":"300",width:"40%",style:{"border-radius":"15px","box-shadow":"5px 5px 10px rgb(0 0 0 / 30%)",position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)"},"append-to-body":!0},{default:j((()=>[E("div",he,[S(f(J),{ref_key:"uploadFormRef",ref:b,model:$.value,rules:L,"label-width":"80px",class:"upload-form"},{default:j((()=>[S(f(X),{label:"选择文件",prop:"files"},{default:j((()=>[S(f(Q),{class:_(["file-upload",{"has-files":$.value.files.length>0}]),drag:"","auto-upload":!1,"on-change":le,"on-remove":se,"show-file-list":!0,limit:10,accept:".dat",multiple:""},{tip:j((()=>[xe])),default:j((()=>[S(f(h),{class:"el-icon--upload"},{default:j((()=>[S(f(D))])),_:1}),_e])),_:1},8,["class"])])),_:1})])),_:1},8,["model"]),E("div",be,[S(f(A),{onClick:ie},{default:j((()=>[V("取消")])),_:1}),S(f(A),{type:"primary",loading:k.value,onClick:oe,disabled:0===$.value.files.length},{default:j((()=>[V(T(k.value?"上传中...":"开始上传"+($.value.files.length>0?`(${$.value.files.length}个文件)`:"")),1)])),_:1},8,["loading","disabled"])])])])),_:1},8,["modelValue","title"])]))}}),[["__scopeId","data-v-06020428"]]);export{ke as default};
