import{d as e,f as a,q as l,r as t,L as o,S as d,c as s,o as u,F as r,g as n,a as c,w as p,i,j as m,E as y,x as g,t as h,G as k,y as f,am as b,Q as v,h as _}from"./index-CzUwgbbU.js";import{E as V}from"./el-checkbox-BalLSeP9.js";import{E as w}from"./el-divider-8rja45mS.js";import{E as T,a as j}from"./el-form-CaL45Rkc.js";import{E as x,a as N}from"./el-col-DrsecgEZ.js";import{E as S}from"./el-switch-CTUKVfWi.js";import"./el-tooltip-l0sNRNKZ.js";import{E}from"./el-popper-DVotpISH.js";import{E as U,b as P}from"./el-radio-group-hM94gECG.js";import"./el-tag-uhvpNveH.js";import"./el-virtual-list-BjZ5Hwgj.js";import{E as F}from"./el-select-v2-g91cJ5Qp.js";import{a as D,E as C}from"./el-select-BjcahQJh.js";/* empty css                */import"./el-text-CSfGUepr.js";import{E as I}from"./el-tree-select-wTEhADJi.js";import{a as q}from"./index-DVyqJ8DS.js";import{k as A,l as L,m as M,h as R,n as z,o as B}from"./index-BEkYTi1a.js";import{_ as $}from"./Dialog.vue_vue_type_style_index_0_lang-DZBgpKQ0.js";import G from"./DetailTemplate-C6gA1OS1.js";import{a as H}from"./index-BMN7n910.js";const O={style:{float:"left"}},Q=e({__name:"AddTask",props:{closeDialog:{type:Function},getList:{type:Function},create:{type:Boolean},schedule:{type:Boolean},taskid:{},tp:{},targetIds:{},getFilter:{type:Function},searchParams:{}},setup(e){const{t:Q}=a(),J=e,K=!!J.tp.includes("Source"),W=l({name:[{required:!0,message:Q("task.msgTaskName"),trigger:"blur"}],target:[{required:!K,message:Q("task.msgTarget"),trigger:"blur"}],node:[{required:!0,message:Q("task.nodeMsg"),trigger:"blur"}],template:[{required:!0,message:"Please select template",trigger:"blur"}],day:[{message:"1-31",trigger:"change",validator:(e,a,l)=>{a&&/^\d+$/.test(a)?a<1||a>31?l(new Error("1-31")):l():l(new Error("1-31"))}}],hour:[{message:"0-24",trigger:"change",validator:(e,a,l)=>{a&&/^\d+$/.test(a)?a<0||a>24?l(new Error("0-24")):l():l(new Error("0-24"))}}],minute:[{message:"0-60",trigger:"change",validator:(e,a,l)=>{a&&/^\d+$/.test(a)?a<0||a>60?l(new Error("0-60")):l():l(new Error("0-60"))}}]}),X=t(!1),Y=t(),Z=l([]),ee=l([]),ae=async()=>{ee.length=0;const e=await R("",1,1e3);e.data.list.length>0&&e.data.list.forEach((e=>{ee.push({value:e.id,label:e.name})}))};o((()=>{(async()=>{const e=await q();e.data.list.length>0?(te.value=!1,e.data.list.forEach((e=>{Z.push({value:e,label:e})}))):(te.value=!0,v.warning(Q("node.onlineNodeMsg")))})(),ae()}));const le=t(!1),te=t(!1),oe=l({name:"",target:"",ignore:"",node:[],allNode:!0,scheduledTasks:!1,duplicates:"None",template:"",cycleType:"daily",search:"",project:[],targetSource:"general",day:1,hour:1,minute:30,week:1,bindProject:null}),de=e=>{le.value=!1,e?(oe.node=[],Z.forEach((e=>oe.node.push(e.value)))):oe.node=[]},se=t(""),ue=t(!1);let re=Q("task.addTemplate");const ne=async e=>{se.value=e,""!=e&&(re=Q("task.editTemplate")),ue.value=!0},ce=()=>{ue.value=!1};d((()=>J.taskid),(async e=>{e?J.schedule?await(async e=>{const a=await B(e);oe.name=a.data.name,oe.target=a.data.target,oe.ignore=a.data.ignore,oe.node=a.data.node,oe.allNode=a.data.allNode,oe.scheduledTasks=a.data.scheduledTasks,oe.hour=a.data.hour,oe.duplicates=a.data.duplicates,oe.template=a.data.template,oe.project=a.data.project,oe.targetSource=a.data.targetSource,oe.day=a.data.day,oe.minute=a.data.minute,oe.week=a.data.week,oe.cycleType=a.data.cycleType})(e):await(async e=>{const a=await z(e);oe.name=a.data.name,oe.target=a.data.target,oe.ignore=a.data.ignore,oe.node=a.data.node,oe.allNode=a.data.allNode,oe.scheduledTasks=a.data.scheduledTasks,oe.hour=a.data.hour,oe.duplicates=a.data.duplicates,oe.template=a.data.template,oe.day=a.data.day,oe.minute=a.data.minute,oe.week=a.data.week,oe.cycleType=a.data.cycleType})(e):(J.schedule?oe.scheduledTasks=!0:oe.scheduledTasks=!1,oe.name="",oe.target="",oe.ignore="",oe.node=[],oe.allNode=!0,oe.duplicates="None",oe.template="")}),{immediate:!0});const pe=t("select"),ie=t(0),me=[{label:Q("task.general"),value:"general"},{label:Q("task.fromProject"),value:"project"},{label:Q("task.fromAsset"),value:"asset"},{label:Q("task.fromRootDomain"),value:"RootDomain"},{label:Q("task.fromSubdomain"),value:"subdomain"}],ye=l([]);return(async()=>{(await H()).data.list.forEach((e=>{ye.push(e)}))})(),(e,a)=>(u(),s(r,null,[n(c(T),{model:oe,"label-width":"auto",rules:W,"status-icon":"",ref_key:"ruleFormRef",ref:Y,disabled:!e.create},{default:p((()=>[n(c(j),{label:c(Q)("task.taskName"),prop:"name"},{default:p((()=>[n(c(y),{modelValue:oe.name,"onUpdate:modelValue":a[0]||(a[0]=e=>oe.name=e),placeholder:c(Q)("task.msgTaskName")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),c(K)?m("",!0):(u(),i(c(j),{key:0,label:c(Q)("task.targetSource")},{default:p((()=>[n(c(F),{style:{width:"50%"},modelValue:oe.targetSource,"onUpdate:modelValue":a[1]||(a[1]=e=>oe.targetSource=e),options:me},null,8,["modelValue"])])),_:1},8,["label"])),"project"==oe.targetSource||"general"==oe.targetSource||c(K)?m("",!0):(u(),i(c(N),{key:1},{default:p((()=>[n(c(x),{span:12},{default:p((()=>[n(c(j),{label:c(Q)("task.search")},{default:p((()=>[c(K)?m("",!0):(u(),i(c(y),{key:0,modelValue:oe.search,"onUpdate:modelValue":a[2]||(a[2]=e=>oe.search=e),placeholder:c(Q)("form.input")},null,8,["modelValue","placeholder"]))])),_:1},8,["label"])])),_:1}),n(c(x),{span:12},{default:p((()=>[n(c(j),{label:c(Q)("task.targetProject")},{default:p((()=>[n(c(I),{modelValue:oe.project,"onUpdate:modelValue":a[3]||(a[3]=e=>oe.project=e),data:ye,placeholder:c(Q)("project.project"),multiple:"",filterable:"","show-checkbox":"","collapse-tags":"","max-collapse-tags":1},null,8,["modelValue","data","placeholder"])])),_:1},8,["label"])])),_:1})])),_:1})),"project"==oe.targetSource?(u(),i(c(j),{key:2,label:c(Q)("task.targetProject")},{default:p((()=>[n(c(I),{modelValue:oe.project,"onUpdate:modelValue":a[4]||(a[4]=e=>oe.project=e),data:ye,placeholder:c(Q)("project.project"),multiple:"",filterable:"","show-checkbox":"","collapse-tags":"","max-collapse-tags":1},null,8,["modelValue","data","placeholder"])])),_:1},8,["label"])):m("",!0),"general"==oe.targetSource?(u(),i(c(j),{key:3,label:c(Q)("task.taskTarget"),prop:"target"},{default:p((()=>[c(K)?m("",!0):(u(),i(c(y),{key:0,modelValue:oe.target,"onUpdate:modelValue":a[5]||(a[5]=e=>oe.target=e),placeholder:c(Q)("task.msgTarget"),type:"textarea",rows:"10"},null,8,["modelValue","placeholder"])),c(K)?(u(),i(c(U),{key:1,modelValue:pe.value,"onUpdate:modelValue":a[6]||(a[6]=e=>pe.value=e)},{default:p((()=>[n(c(P),{value:"select"},{default:p((()=>[g(h(c(Q)("task.select")),1)])),_:1}),n(c(P),{value:"search"},{default:p((()=>[g(h(c(Q)("export.exportTypeSearch")),1)])),_:1})])),_:1},8,["modelValue"])):m("",!0)])),_:1},8,["label"])):m("",!0),"search"==pe.value&&c(K)?(u(),i(c(j),{key:4,label:c(Q)("task.targetNumber")},{default:p((()=>[n(c(y),{modelValue:ie.value,"onUpdate:modelValue":a[7]||(a[7]=e=>ie.value=e)},null,8,["modelValue"])])),_:1},8,["label"])):m("",!0),"project"!=oe.targetSource?(u(),i(c(j),{key:5,label:c(Q)("task.ignore"),prop:"ignore"},{default:p((()=>[n(c(y),{modelValue:oe.ignore,"onUpdate:modelValue":a[8]||(a[8]=e=>oe.ignore=e),placeholder:c(Q)("task.ignoreMsg"),type:"textarea",rows:"5"},null,8,["modelValue","placeholder"])])),_:1},8,["label"])):m("",!0),n(c(N),null,{default:p((()=>[n(c(x),{span:12},{default:p((()=>[n(c(j),{label:c(Q)("task.nodeSelect"),prop:"node"},{default:p((()=>[n(c(F),{modelValue:oe.node,"onUpdate:modelValue":a[9]||(a[9]=e=>oe.node=e),filterable:"",options:Z,placeholder:"Please select node",style:{width:"80%"},multiple:"","tag-type":"success","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":7},{header:p((()=>[n(c(V),{disabled:te.value,indeterminate:le.value,onChange:de},{default:p((()=>[g(" All ")])),_:1},8,["disabled","indeterminate"])])),_:1},8,["modelValue","options"])])),_:1},8,["label"])])),_:1}),n(c(x),{span:12},{default:p((()=>[n(c(j),{label:c(Q)("task.autoNode")},{default:p((()=>[n(c(E),{effect:"dark",content:c(Q)("task.selectNodeMsg"),placement:"top"},{default:p((()=>[n(c(S),{modelValue:oe.allNode,"onUpdate:modelValue":a[10]||(a[10]=e=>oe.allNode=e),"inline-prompt":"","active-text":c(Q)("common.switchAction"),"inactive-text":c(Q)("common.switchInactive")},null,8,["modelValue","active-text","inactive-text"])])),_:1},8,["content"])])),_:1},8,["label"])])),_:1})])),_:1}),n(c(j),{label:c(Q)("project.scheduledTasks")},{default:p((()=>[n(c(E),{effect:"dark",content:c(Q)("project.msgScheduledTasks"),placement:"top"},{default:p((()=>[n(c(S),{modelValue:oe.scheduledTasks,"onUpdate:modelValue":a[11]||(a[11]=e=>oe.scheduledTasks=e),"inline-prompt":"","active-text":c(Q)("common.switchAction"),"inactive-text":c(Q)("common.switchInactive")},null,8,["modelValue","active-text","inactive-text"])])),_:1},8,["content"])])),_:1},8,["label"]),oe.scheduledTasks?(u(),i(c(j),{key:6,label:c(Q)("project.cycle"),prop:"type"},{default:p((()=>[n(c(N),{gutter:10,style:{width:"100%"}},{default:p((()=>[n(c(x),{span:5},{default:p((()=>[n(c(D),{modelValue:oe.cycleType,"onUpdate:modelValue":a[12]||(a[12]=e=>oe.cycleType=e),style:{width:"100%"}},{default:p((()=>[n(c(C),{label:c(Q)("task.daily"),value:"daily"},null,8,["label"]),n(c(C),{label:c(Q)("task.ndays"),value:"ndays"},null,8,["label"]),n(c(C),{label:c(Q)("task.nhours"),value:"nhours"},null,8,["label"]),n(c(C),{label:c(Q)("task.weekly"),value:"weekly"},null,8,["label"]),n(c(C),{label:c(Q)("task.monthly"),value:"monthly"},null,8,["label"])])),_:1},8,["modelValue"])])),_:1}),"weekly"==oe.cycleType?(u(),i(c(x),{key:0,span:5},{default:p((()=>[n(c(D),{modelValue:oe.week,"onUpdate:modelValue":a[13]||(a[13]=e=>oe.week=e),style:{width:"100%"}},{default:p((()=>[n(c(C),{label:c(Q)("task.monday"),value:"0"},null,8,["label"]),n(c(C),{label:c(Q)("task.tuesday"),value:"1"},null,8,["label"]),n(c(C),{label:c(Q)("task.wednesday"),value:"2"},null,8,["label"]),n(c(C),{label:c(Q)("task.thursday"),value:"3"},null,8,["label"]),n(c(C),{label:c(Q)("task.friday"),value:"4"},null,8,["label"]),n(c(C),{label:c(Q)("task.saturday"),value:"5"},null,8,["label"]),n(c(C),{label:c(Q)("task.sunday"),value:"6"},null,8,["label"])])),_:1},8,["modelValue"])])),_:1})):m("",!0),"ndays"===oe.cycleType||"monthly"==oe.cycleType?(u(),i(c(x),{key:1,span:5},{default:p((()=>[n(c(j),{prop:"day"},{default:p((()=>[n(c(y),{style:{width:"100%"},modelValue:oe.day,"onUpdate:modelValue":a[14]||(a[14]=e=>oe.day=e)},{append:p((()=>[g(h(c(Q)("task.day")),1)])),_:1},8,["modelValue"])])),_:1})])),_:1})):m("",!0),"daily"===oe.cycleType||"ndays"===oe.cycleType||"nhours"==oe.cycleType||"weekly"==oe.cycleType||"monthly"==oe.cycleType?(u(),i(c(x),{key:2,span:5},{default:p((()=>[n(c(j),{prop:"hour"},{default:p((()=>[n(c(y),{style:{width:"100%"},modelValue:oe.hour,"onUpdate:modelValue":a[15]||(a[15]=e=>oe.hour=e)},{append:p((()=>[g(h(c(Q)("task.hour")),1)])),_:1},8,["modelValue"])])),_:1})])),_:1})):m("",!0),"daily"===oe.cycleType||"ndays"===oe.cycleType||"nhours"==oe.cycleType||"weekly"==oe.cycleType||"monthly"==oe.cycleType?(u(),i(c(x),{key:3,span:5},{default:p((()=>[n(c(j),{prop:"minute"},{default:p((()=>[n(c(y),{style:{width:"100%"},modelValue:oe.minute,"onUpdate:modelValue":a[16]||(a[16]=e=>oe.minute=e)},{append:p((()=>[g(h(c(Q)("task.minute")),1)])),_:1},8,["modelValue"])])),_:1})])),_:1})):m("",!0)])),_:1})])),_:1},8,["label"])):m("",!0),n(c(w),{"content-position":"center",style:{left:"20%",width:"60%"}},{default:p((()=>[g(h(c(Q)("task.duplicates")),1)])),_:1}),n(c(N),null,{default:p((()=>[n(c(x),{span:24},{default:p((()=>[n(c(j),{label:c(Q)("task.duplicates"),prop:"type"},{default:p((()=>[n(c(U),{modelValue:oe.duplicates,"onUpdate:modelValue":a[17]||(a[17]=e=>oe.duplicates=e)},{default:p((()=>[n(c(P),{label:"None",name:"duplicates",checked:!0,value:"None"}),n(c(E),{effect:"dark",content:c(Q)("task.duplicatesMsg"),placement:"top"},{default:p((()=>[n(c(P),{label:c(Q)("task.duplicatesSubdomain"),name:"duplicates",value:"subdomain"},null,8,["label"])])),_:1},8,["content"])])),_:1},8,["modelValue"])])),_:1},8,["label"])])),_:1})])),_:1}),n(c(w),{"content-position":"center",style:{left:"20%",width:"60%"}},{default:p((()=>[g(h(c(Q)("router.scanTemplate")),1)])),_:1}),n(c(j),{label:c(Q)("router.scanTemplate"),prop:"template"},{default:p((()=>[n(c(D),{modelValue:oe.template,"onUpdate:modelValue":a[19]||(a[19]=e=>oe.template=e),placeholder:"Please select template",style:{width:"30%"}},{footer:p((()=>[n(c(f),{type:"success",size:"small",plain:"",style:{"margin-left":"15px"},onClick:a[18]||(a[18]=b((e=>ne("")),["stop"]))},{default:p((()=>[g(h(c(Q)("common.new")),1)])),_:1})])),default:p((()=>[(u(!0),s(r,null,k(ee,(e=>(u(),i(c(C),{key:e.value,label:e.label,value:e.value},{default:p((()=>[n(c(N),null,{default:p((()=>[n(c(x),{span:16},{default:p((()=>[_("span",O,h(e.label),1)])),_:2},1024),n(c(x),{span:8},{default:p((()=>[n(c(f),{type:"primary",size:"small",style:{"margin-left":"15px"},onClick:b((a=>ne(e.value)),["stop"])},{default:p((()=>[g(h(c(Q)("common.edit")),1)])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1032,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1},8,["label"]),n(c(w)),n(c(N),null,{default:p((()=>[n(c(x),{span:2,offset:10},{default:p((()=>[n(c(j),null,{default:p((()=>[n(c(f),{type:"primary",onClick:a[20]||(a[20]=e=>(async e=>{X.value=!0;try{if(!e)return;if(await e.validate()){let e,a=l({});"search"==pe.value&&(J.getFilter&&(a=J.getFilter()),J.searchParams&&(oe.search=J.searchParams)),K&&(oe.targetSource=J.tp),e=J.taskid?await A(J.taskid,oe.name,oe.target,oe.ignore,oe.node,oe.allNode,oe.duplicates,oe.scheduledTasks,oe.hour,oe.template,pe.value,oe.search,a,ie.value,J.targetIds,oe.project,oe.targetSource,oe.day,oe.minute,oe.week,oe.bindProject,oe.cycleType):J.schedule?await L(oe.name,oe.target,oe.ignore,oe.node,oe.allNode,oe.duplicates,oe.scheduledTasks,oe.hour,oe.template,pe.value,oe.search,a,ie.value,J.targetIds,oe.project,oe.targetSource,oe.day,oe.minute,oe.week,oe.bindProject,oe.cycleType):await M(oe.name,oe.target,oe.ignore,oe.node,oe.allNode,oe.duplicates,oe.scheduledTasks,oe.hour,oe.template,pe.value,oe.search,a,ie.value,J.targetIds,oe.project,oe.targetSource,oe.day,oe.minute,oe.week,oe.bindProject,oe.cycleType),200===e.code&&(J.closeDialog(),J.getList())}}catch(a){}finally{X.value=!1}})(Y.value)),loading:X.value},{default:p((()=>[g(h(c(Q)("task.save")),1)])),_:1},8,["loading"])])),_:1})])),_:1})])),_:1})])),_:1},8,["model","rules","disabled"]),n(c($),{modelValue:ue.value,"onUpdate:modelValue":a[21]||(a[21]=e=>ue.value=e),title:c(re),center:"",fullscreen:"",style:{"border-radius":"15px","box-shadow":"5px 5px 10px rgb(0 0 0 / 30%)"}},{default:p((()=>[n(G,{closeDialog:ce,getList:ae,id:se.value},null,8,["id"])])),_:1},8,["modelValue","title"])],64))}});export{Q as _};
