import{ay as e,az as a,bv as t,bl as l,ch as s,al as o,d as r,ak as i,r as d,ad as n,S as c,c as u,o as p,i as m,ar as v,aY as g,a as f,w as j,I as y,C as h,n as _,b5 as b,b4 as x,aM as k,f as w,u as C,h as S,g as z,F as E,G as P,dM as D,y as A,x as V,t as T,Q as $,p as L,l as U,j as B,am as F,N as I,s as M,_ as q}from"./index-CzUwgbbU.js";import{E as N,a as R,b as G}from"./el-dropdown-item-DdR0K52r.js";import"./el-popper-DVotpISH.js";import{E as O}from"./el-pagination-D2lwhAbz.js";import{E as W}from"./el-tag-uhvpNveH.js";import"./el-select-BjcahQJh.js";import{E as H}from"./el-checkbox-BalLSeP9.js";import{E as J}from"./el-switch-CTUKVfWi.js";import{E as K,a as Q}from"./el-form-CaL45Rkc.js";import{E as X}from"./el-upload-DAFC_VoU.js";import"./el-progress-o2Jtvl9S.js";import{_ as Y}from"./Dialog.vue_vue_type_style_index_0_lang-DZBgpKQ0.js";import{u as Z,d as ee}from"./index-BMN7n910.js";import{_ as ae}from"./AddProject.vue_vue_type_script_setup_true_lang-CxAokcGx.js";import{u as te}from"./useIcon-DzwnNKzL.js";import"./castArray-BNFsq8IP.js";import"./refs-CzcJSp1f.js";import"./index-IhT-f-PJ.js";import"./index-BYNKo7qk.js";import"./strings-D5lndUib.js";import"./debounce-8wwtyAGg.js";import"./index-DpusPEJ4.js";import"./index-CyWn8tDN.js";import"./el-divider-8rja45mS.js";import"./el-col-DrsecgEZ.js";import"./el-tooltip-l0sNRNKZ.js";import"./el-radio-group-hM94gECG.js";import"./el-virtual-list-BjZ5Hwgj.js";import"./raf-Dzw5j5A8.js";import"./el-select-v2-g91cJ5Qp.js";import"./el-input-number-BSHGSPeM.js";import"./el-text-CSfGUepr.js";import"./index-DVyqJ8DS.js";import"./index-BEkYTi1a.js";import"./DetailTemplate-C6gA1OS1.js";import"./el-card-D90KorQn.js";/* empty css                */import"./index-BYIjyFRt.js";import"./index-BB8DcDyN.js";const le=e({size:{type:[Number,String],values:s,default:"",validator:e=>l(e)},shape:{type:String,values:["circle","square"],default:"circle"},icon:{type:t},src:{type:String,default:""},alt:String,srcSet:String,fit:{type:a(String),default:"cover"}}),se={error:e=>e instanceof Event},oe=r({name:"ElAvatar"});const re=k(o(r({...oe,props:le,emits:se,setup(e,{emit:a}){const t=e,s=i("avatar"),o=d(!1),r=n((()=>{const{size:e,icon:a,shape:l}=t,o=[s.b()];return b(e)&&o.push(s.m(e)),a&&o.push(s.m("icon")),l&&o.push(s.m(l)),o})),k=n((()=>{const{size:e}=t;return l(e)?s.cssVarBlock({size:x(e)||""}):void 0})),w=n((()=>({objectFit:t.fit})));function C(e){o.value=!0,a("error",e)}return c((()=>t.src),(()=>o.value=!1)),(e,a)=>(p(),u("span",{class:_(f(r)),style:g(f(k))},[!e.src&&!e.srcSet||o.value?e.icon?(p(),m(f(h),{key:1},{default:j((()=>[(p(),m(y(e.icon)))])),_:1})):v(e.$slots,"default",{key:2}):(p(),u("img",{key:0,src:e.src,alt:e.alt,srcset:e.srcSet,style:g(f(w)),onError:C},null,44,["src","alt","srcset"]))],6))}}),[["__file","avatar.vue"]])),ie=e=>(L("data-v-06020428"),e=e(),U(),e),de={class:"project-list"},ne={class:"project-grid"},ce=["onClick"],ue={class:"card-header"},pe={class:"avatar-container"},me={class:"card-body"},ve={class:"project-name"},ge={class:"project-tag"},fe={class:"project-stats"},je=ie((()=>S("data",null,null,-1))),ye={class:"pagination"},he={class:"upload-dialog-content"},_e=ie((()=>S("div",{class:"el-upload__text"},[V(" 将文件拖到此处，或"),S("em",null,"点击选择多个文件")],-1))),be=ie((()=>S("div",{class:"el-upload__tip"}," 支持选择多个 .dat 格式文件，单个文件不超过 50MB ",-1))),xe={class:"dialog-footer"},ke=q(r({__name:"ProjectList",props:{tableDataList:{type:Array,default:()=>[]},getProjectTag:{type:Function,required:!0},total:{type:Number,default:0},multipleSelection:{type:Boolean},selectedRows:{type:Array,default:()=>[]}},setup(e){const{t:a}=w(),{push:t}=C(),l=e;d(!1);let s="";const o=d(!1),r=()=>{o.value=!1},i=te({icon:"ep:edit"}),n=te({icon:"ep:delete"}),v=te({icon:"ep:data-analysis"}),g=te({icon:"ep:upload"}),y=d(!1),b=d(""),x=d(),k=d(!1),L=d({tag:"",files:[]}),U={tag:[{required:!0,message:"请输入项目标签",trigger:"blur"},{min:1,max:50,message:"标签长度应在 1 到 50 个字符",trigger:"blur"}]},q=async e=>{switch(e.type){case"edit":(async e=>{s=e,o.value=!0})(e.id);break;case"del":const r=d(!1);I({title:"Delete",draggable:!0,message:()=>M("div",{style:{display:"flex",alignItems:"center"}},[M("p",{style:{margin:"0 10px 0 0"}},a("task.delAsset")),M(J,{modelValue:r.value,"onUpdate:modelValue":e=>{r.value=e}})])}).then((async()=>{await ee([e.id],r.value),l.getProjectTag(1,50)}));break;case"aggregation":t(`/project-management/project-detail?id=${e.id}`);break;case"upload":b.value=e.id,y.value=!0}},le=(e,a)=>{L.value.files=[],a.forEach((e=>{const a=e.raw;if(!a)return;if(a.size>52428800)return void $.error(`文件 ${a.name} 大小不能超过 50MB`);const t=a.name.toLowerCase();[".dat"].some((e=>t.endsWith(e)))?L.value.files.push(a):$.error(`文件 ${a.name} 仅支持 .dat 格式`)}))},se=(e,a)=>{L.value.files=[],a.forEach((e=>{const a=e.raw;a&&L.value.files.push(a)}))},oe=async()=>{x.value&&await x.value.validate((async e=>{if(e)if(0!==L.value.files.length)try{k.value=!0;const e=await Z(b.value,L.value.files);if(200!==e.code)throw new Error(e.message||"上传失败");$.success(`成功上传 ${L.value.files.length} 个文件！`),ie(),l.getProjectTag(ke.value,we.value)}catch(a){$.error(a.message||"上传失败，请重试")}finally{k.value=!1}else $.error("请选择要上传的文件")}))},ie=()=>{var e;y.value=!1,L.value.tag="",L.value.files=[],null==(e=x.value)||e.resetFields()},ke=d(1),we=d(50),Ce=d(!1),Se=d(!0),ze=d(!1),Ee=()=>{l.getProjectTag(ke.value,we.value)},Pe=d([]);c((()=>l.selectedRows),(e=>{Pe.value=e})),c((()=>l.tableDataList),(e=>{De.value=Pe.value.length===e.length}));const De=d(!1);return(d,c)=>(p(),u("div",de,[S("div",ne,[(p(!0),u(E,null,P(e.tableDataList,(l=>(p(),u("div",{key:l.id,class:"project-card"},[S("div",{class:"card-content",onClick:e=>{return a=l.id,void t(`/project-management/project-detail?id=${a}`);var a}},[S("div",ue,[e.multipleSelection?(p(),m(f(H),{key:0,value:Pe.value.includes(l.id),onClick:F((e=>((e,a)=>{e.preventDefault(),e.stopPropagation();const t=Pe.value.indexOf(a);-1===t?Pe.value.push(a):Pe.value.splice(t,1)})(e,l.id)),["stop"]),class:"checkbox"},null,8,["value","onClick"])):B("",!0),S("div",pe,[l.logo?(p(),m(f(re),{key:0,src:l.logo,class:"avatar",fit:"cover"},null,8,["src"])):(p(),m(f(re),{key:1,class:"avatar avatar-placeholder"},{default:j((()=>[V(T(l.name.charAt(0).toUpperCase()),1)])),_:2},1024))])]),S("div",me,[S("h3",ve,T(l.name),1),S("div",ge,[z(f(W),{size:"small",effect:"plain"},{default:j((()=>[V(T(l.tag),1)])),_:2},1024)]),S("div",fe,[z(f(h),null,{default:j((()=>[je])),_:1}),S("span",null,T(f(a)("project.totalAssets"))+": "+T(l.AssetCount),1)])])],8,ce),z(f(G),{trigger:"contextmenu",onCommand:q,class:"card-dropdown"},{dropdown:j((()=>[z(f(N),null,{default:j((()=>[z(f(R),{icon:f(i),command:{type:"edit",id:l.id}},{default:j((()=>[V(T(f(a)("common.edit")),1)])),_:2},1032,["icon","command"]),z(f(R),{icon:f(n),command:{type:"del",id:l.id}},{default:j((()=>[V(T(f(a)("common.delete")),1)])),_:2},1032,["icon","command"]),z(f(R),{icon:f(g),command:{type:"upload",id:l.id}},{default:j((()=>[V(T(f(a)("common.uplaod")),1)])),_:2},1032,["icon","command"]),z(f(R),{icon:f(v),command:{type:"aggregation",id:l.id}},{default:j((()=>[V(T(f(a)("project.aggregation")),1)])),_:2},1032,["icon","command"])])),_:2},1024)])),default:j((()=>[S("div",{class:"dropdown-trigger",onClick:c[0]||(c[0]=F((()=>{}),["stop"]))})])),_:2},1024)])))),128))]),S("div",ye,[z(f(O),{"current-page":ke.value,"onUpdate:currentPage":c[1]||(c[1]=e=>ke.value=e),"page-size":we.value,"onUpdate:pageSize":c[2]||(c[2]=e=>we.value=e),"page-sizes":[50,70,100,200,400],small:Ce.value,disabled:ze.value,background:Se.value,layout:"total, sizes, prev, pager, next, jumper",total:e.total,onSizeChange:Ee,onCurrentChange:Ee},null,8,["current-page","page-size","small","disabled","background","total"])]),z(f(Y),{modelValue:o.value,"onUpdate:modelValue":c[3]||(c[3]=e=>o.value=e),title:f(a)("common.edit"),center:"",style:{"border-radius":"15px","box-shadow":"5px 5px 10px rgb(0 0 0 / 30%)"}},{default:j((()=>[z(ae,{closeDialog:r,projectid:f(s),getProjectData:l.getProjectTag,schedule:!1},null,8,["projectid","getProjectData"])])),_:1},8,["modelValue","title"]),z(f(Y),{modelValue:y.value,"onUpdate:modelValue":c[4]||(c[4]=e=>y.value=e),title:f(a)("common.upload"),center:"","max-height":"300",width:"40%",style:{"border-radius":"15px","box-shadow":"5px 5px 10px rgb(0 0 0 / 30%)",position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)"},"append-to-body":!0},{default:j((()=>[S("div",he,[z(f(K),{ref_key:"uploadFormRef",ref:x,model:L.value,rules:U,"label-width":"80px",class:"upload-form"},{default:j((()=>[z(f(Q),{label:"选择文件",prop:"files"},{default:j((()=>[z(f(X),{class:_(["file-upload",{"has-files":L.value.files.length>0}]),drag:"","auto-upload":!1,"on-change":le,"on-remove":se,"show-file-list":!0,limit:10,accept:".dat",multiple:""},{tip:j((()=>[be])),default:j((()=>[z(f(h),{class:"el-icon--upload"},{default:j((()=>[z(f(D))])),_:1}),_e])),_:1},8,["class"])])),_:1})])),_:1},8,["model"]),S("div",xe,[z(f(A),{onClick:ie},{default:j((()=>[V("取消")])),_:1}),z(f(A),{type:"primary",loading:k.value,onClick:oe,disabled:0===L.value.files.length},{default:j((()=>[V(T(k.value?"上传中...":"开始上传"+(L.value.files.length>0?`(${L.value.files.length}个文件)`:"")),1)])),_:1},8,["loading","disabled"])])])])),_:1},8,["modelValue","title"])]))}}),[["__scopeId","data-v-06020428"]]);export{ke as default};
