import{P as e,g as a,U as t}from"./PanelGroup-DUgtg1f_.js";import{d as l,f as s,r as o,q as r,s as n,v as d,c as m,o as i,g as u,w as p,a as c,F as f,h as v,t as g,i as h,j as _,x as y,E as x,y as b,z as j,_ as k}from"./index-B3EiCo2S.js";import{E as w,a as S}from"./el-col-DtKbKOG8.js";import{E as U}from"./el-card-CrrcCGp_.js";import{E as C}from"./el-progress-dMr12y8C.js";import{E as V}from"./el-text-CmnqunHf.js";import"./el-tooltip-l0sNRNKZ.js";import{E as N}from"./el-popper-BVxf87sZ.js";import{E as A,a as E}from"./el-form-BuBNySiR.js";import{_ as I}from"./Table.vue_vue_type_script_lang-cn7j-svV.js";import{E as F}from"./el-tag-B27ii0Fj.js";import{_ as T}from"./Dialog.vue_vue_type_style_index_0_lang-Chb3ii7l.js";import{g as z}from"./index-DUjuAl0C.js";import{g as M}from"./index-BGQZL4Fw.js";import{c as P}from"./index-jOLBrEFX.js";import"./el-skeleton-item-Bu2reypI.js";import"./CountTo.vue_vue_type_script_setup_true_lang-BAMdfKnR.js";import"./index-QUlrjjpt.js";import"./index-BG_6nwkU.js";import"./castArray-BI5HMQaJ.js";import"./el-table-column-D1qTPSN1.js";import"./isArrayLikeObject-DH0T-Gqc.js";import"./index-DoD9gG_2.js";import"./debounce-BcWuyWDS.js";import"./el-checkbox-DISW8vgz.js";import"./raf-BaeSuW_0.js";import"./el-pagination-BrC_eYrZ.js";import"./el-select-CY6LOZx-.js";import"./strings-BciOnfsg.js";import"./index-DjN3fv7d.js";import"./el-image-viewer-CdBFXqlh.js";import"./el-empty-DcP8J_Rv.js";import"./tsxHelper-C_2HfyWV.js";import"./el-dropdown-item-D01yRie3.js";import"./refs-BF7DfOff.js";import"./index-8Peh_Rn3.js";const B={class:"flex flex-col gap-2"},H=k(l({__name:"Analysis",setup(l){const{t:k}=s(),H=o(!0),O=r([{field:"nodeName",label:k("node.nodeName")},{field:"taskCount",label:k("node.taskCount"),formatter:(e,a,t)=>n(F,{round:!0,effect:"dark"},(()=>t))},{field:"nodeStatus",label:k("node.nodeStatus"),formatter:(e,a,t)=>n(F,{type:"1"===t?"success":"2"===t?"warning":"danger",effect:"dark"},(()=>k("1"==t?"node.statusRun":"2"==t?"node.statusStop":"node.statusError")))}]),D=r([{field:"name",label:k("task.taskName")},{field:"taskNum",label:k("task.taskCount"),formatter:(e,a,t)=>n(F,{round:!0,effect:"dark"},(()=>t))},{field:"progress",label:k("task.taskProgress"),formatter:(e,a,t)=>n(C,{percentage:t,type:"line",striped:!0,status:t<100?"":"success",stripedFlow:t<100})},{field:"creatTime",label:k("task.createTime")}]),R=r([{field:"nodeName",label:k("node.nodeName")},{field:"nodeUsageCpu",label:k("node.nodeUsageCpu"),formatter:(e,a,t)=>{let l=parseFloat(t);return l=parseFloat(l.toFixed(2)),n(C,{percentage:l,type:"dashboard",color:l<50?"#26a33f":l<=80?"#fe9900":"#df2800"})}},{field:"nodeUsageMemory",label:k("node.nodeUsageMemory"),formatter:(e,a,t)=>{let l=parseFloat(t);return l=parseFloat(l.toFixed(2)),n(C,{percentage:l,type:"dashboard",color:l<50?"#26a33f":l<80?"#fe9900":"#df2800"})}}]),q=r([{field:"name",label:k("common.name")},{field:"cversion",label:k("common.cversion")},{field:"lversion",label:k("common.lversion"),formatter:(e,a,t)=>{if(e.cversion!=e.lversion){ee.value=!0;const a=e.msg.split("\\n");let l="";return a.forEach((e=>{l+=`<div>${e}</div>`})),n(N,{placement:"top",content:l,rawContent:!0},[n(V,{type:"danger"},t)])}return n(V,t)}}]);let G=o([]);const J=o([]),K=async()=>{try{const e=await z();e&&e.data&&Array.isArray(e.data.list)&&(J.value=e.data.list.map((e=>({nodeName:e.name,taskCount:e.running,nodeStatus:e.state,nodeUsageCpu:e.cpuNum,nodeUsageMemory:e.memNum}))),G.value=r(e.data.list.map((e=>({nodeName:e.name,nodeUsageCpu:e.cpuNum,nodeUsageMemory:e.memNum})))))}catch(e){}finally{H.value=!1}},L=o([]),X=async()=>{const e=await M("",1,10);L.value=r(e.data.list.map((e=>({name:e.name,taskNum:e.taskNum,progress:e.progress,creatTime:e.creatTime}))))},$=o([]),Q=async()=>{await Promise.all([K(),X()]),H.value=!1};(async()=>{const e=await a();$.value=r(e.data.list.map((e=>({name:e.name,cversion:e.cversion,lversion:e.lversion,msg:e.msg}))))})(),Q();const W=setInterval(Q,1e4);d((()=>{clearInterval(W)}));const Y=o(""),Z=async()=>{if(Y.value){200==(await P(Y.value)).code&&(localStorage.setItem("plugin_key",Y.value),le.value=!1,te.value=!0)}},ee=o(!1),ae=o({server:"https://github.com/Autumn-27/ScopeSentry/archive/refs/heads/main.zip",scan:""}),te=o(!1),le=o(!1);async function se(){const e=localStorage.getItem("plugin_key");505==(await t(ae.value.server,ae.value.scan,e)).code&&localStorage.removeItem("plugin_key")}return(a,t)=>{const l=j("BaseButton");return i(),m(f,null,[u(e),u(c(S),{gutter:20,justify:"space-between"},{default:p((()=>[u(c(w),{xl:12,lg:12,md:24,sm:24,xs:24},{default:p((()=>[u(c(U),{shadow:"hover",class:"mb-20px"},{header:p((()=>[v("span",null,g(c(k)("dashboard.nodeInfo")),1)])),default:p((()=>[u(c(I),{columns:O,data:J.value,stripe:"",border:!1,height:250},null,8,["columns","data"])])),_:1})])),_:1}),u(c(w),{xl:12,lg:12,md:24,sm:24,xs:24},{default:p((()=>[u(c(U),{shadow:"hover",class:"mb-20px"},{header:p((()=>[v("span",null,g(c(k)("dashboard.taskInfo")),1)])),default:p((()=>[u(c(I),{columns:D,data:L.value,stripe:"",border:!1,height:250,"tooltip-options":{offset:1,showArrow:!1,effect:"dark",enterable:!1,showAfter:0,popperOptions:{},popperClass:"test",placement:"bottom",hideAfter:0,disabled:!0}},null,8,["columns","data"])])),_:1})])),_:1}),u(c(w),{span:12},{default:p((()=>[u(c(U),{shadow:"hover",class:"mb-25px"},{header:p((()=>[v("div",null,[v("span",null,g(c(k)("node.nodeUsageStatus")),1)])])),default:p((()=>[u(c(I),{columns:R,data:c(G),highlightCurrentRow:!1,stripe:"",border:!1,height:600},null,8,["columns","data"])])),_:1})])),_:1}),u(c(w),{span:12},{default:p((()=>[u(c(U),{shadow:"hover",class:"mb-25px"},{header:p((()=>[u(c(S),null,{default:p((()=>[u(c(w),{span:12},{default:p((()=>[v("div",null,[v("span",null,g(c(k)("common.version")),1),ee.value?(i(),h(c(V),{key:0,type:"danger",size:"small",style:{position:"relative",left:"1rem"}},{default:p((()=>[y("*"+g(c(k)("common.updatemsg")),1)])),_:1})):_("",!0)])])),_:1})])),_:1})])),default:p((()=>[u(c(I),{columns:q,data:$.value,stripe:"",border:!1,height:600},null,8,["columns","data"])])),_:1})])),_:1})])),_:1}),u(c(T),{modelValue:te.value,"onUpdate:modelValue":t[2]||(t[2]=e=>te.value=e),title:"Update",center:"",style:{"border-radius":"15px","box-shadow":"5px 5px 10px rgb(0 0 0 / 30%)"},maxHeight:430},{default:p((()=>[u(c(V),{type:"danger",size:"small",style:{position:"relative",left:"1rem"}},{default:p((()=>[y("*更新目前只支持docker容器搭建的程序，输入的url地址确保docker内可访问，节点最新版在github中releases的linux版本")])),_:1}),u(c(A),{model:ae.value,"label-width":"120px",class:"upload-form"},{default:p((()=>[u(c(E),{label:"server url"},{default:p((()=>[u(c(x),{modelValue:ae.value.server,"onUpdate:modelValue":t[0]||(t[0]=e=>ae.value.server=e),placeholder:"server url"},null,8,["modelValue"])])),_:1}),u(c(E),{label:"scan url"},{default:p((()=>[u(c(x),{modelValue:ae.value.scan,"onUpdate:modelValue":t[1]||(t[1]=e=>ae.value.scan=e),placeholder:"scan url(https://github.com/Autumn-27/ScopeSentry-Scan/releases/download/vx.x.x/ScopeSentry-Scan_linux_amd64_vx.x.x.zip)"},null,8,["modelValue"])])),_:1}),u(c(E),null,{default:p((()=>[u(c(b),{type:"primary",onClick:se},{default:p((()=>[y("Submit")])),_:1})])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue"]),u(c(T),{modelValue:le.value,"onUpdate:modelValue":t[4]||(t[4]=e=>le.value=e),title:c(k)("plugin.key"),center:"",width:"30%",style:{height:"200px","max-width":"400px"}},{default:p((()=>[v("div",B,[u(c(N),{class:"item",effect:"dark",content:c(k)("plugin.keyMsg"),placement:"top"},{default:p((()=>[u(c(x),{modelValue:Y.value,"onUpdate:modelValue":t[3]||(t[3]=e=>Y.value=e)},null,8,["modelValue"])])),_:1},8,["content"]),u(l,{onClick:Z,type:"primary",class:"w-full"},{default:p((()=>[y("确定")])),_:1})])])),_:1},8,["modelValue","title"])],64)}}}),[["__scopeId","data-v-d7baf522"]]);export{H as default};
