import{bz as e,b5 as a,ay as t,aD as l,bB as s,aC as o,b7 as u,aA as n,az as i,al as r,d as p,bf as d,aQ as v,ba as c,ak as f,r as g,at as m,I as b,bg as h,v as y,J as $,i as x,o as w,w as S,h as A,a as k,aY as F,n as B,g as C,E as I,bd as _,a$ as E,am as T,aZ as K,ar as R,V as W,c as V,C as z,ao as L,F as N,G as j,x as q,t as D,ah as H,bE as O,aM as U}from"./index-Bsz_-kew.js";import{u as J,E as M}from"./el-popper-DexwxjEf.js";import{d as P}from"./debounce-Bd5c_m29.js";const G=t({valueKey:{type:String,default:"value"},modelValue:{type:[String,Number],default:""},debounce:{type:Number,default:300},placement:{type:i(String),values:["top","top-start","top-end","bottom","bottom-start","bottom-end"],default:"bottom-start"},fetchSuggestions:{type:i([Function,Array]),default:n},popperClass:{type:String,default:""},triggerOnFocus:{type:Boolean,default:!0},selectWhenUnmatched:{type:Boolean,default:!1},hideLoading:{type:Boolean,default:!1},teleported:J.teleported,appendTo:J.appendTo,highlightFirstItem:{type:Boolean,default:!1},fitInputWidth:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},name:String,...u(["ariaLabel"])}),Q={[o]:e=>a(e),[s]:e=>a(e),[l]:e=>a(e),focus:e=>e instanceof FocusEvent,blur:e=>e instanceof FocusEvent,clear:()=>!0,select:a=>e(a)},Y="ElAutocomplete",Z=p({name:Y,inheritAttrs:!1});const X=U(r(p({...Z,props:G,emits:Q,setup(e,{expose:a,emit:t}){const u=e,n=d(),i=v(),r=c(),p=f("autocomplete"),U=g(),J=g(),G=g(),Q=g();let Z=!1,X=!1;const ee=g([]),ae=g(-1),te=g(""),le=g(!1),se=g(!1),oe=g(!1),ue=m(),ne=b((()=>i.style)),ie=b((()=>(ee.value.length>0||oe.value)&&le.value)),re=b((()=>!u.hideLoading&&oe.value)),pe=b((()=>U.value?Array.from(U.value.$el.querySelectorAll("input")):[])),de=()=>{ie.value&&(te.value=`${U.value.$el.offsetWidth}px`)},ve=()=>{ae.value=-1},ce=async e=>{if(se.value)return;const a=e=>{oe.value=!1,se.value||(H(e)?(ee.value=e,ae.value=u.highlightFirstItem?0:-1):O(Y,"autocomplete suggestions must be an array"))};if(oe.value=!0,H(u.fetchSuggestions))a(u.fetchSuggestions);else{const t=await u.fetchSuggestions(e,a);H(t)&&a(t)}},fe=P(ce,u.debounce),ge=e=>{const a=!!e;if(t(s,e),t(o,e),se.value=!1,le.value||(le.value=a),!u.triggerOnFocus&&!e)return se.value=!0,void(ee.value=[]);fe(e)},me=e=>{var a;r.value||("INPUT"!==(null==(a=e.target)?void 0:a.tagName)||pe.value.includes(document.activeElement))&&(le.value=!0)},be=e=>{t(l,e)},he=e=>{var a;if(X)X=!1;else{le.value=!0,t("focus",e);const l=null!=(a=u.modelValue)?a:"";u.triggerOnFocus&&!Z&&fe(String(l))}},ye=e=>{setTimeout((()=>{var a;(null==(a=G.value)?void 0:a.isFocusInsideContent())?X=!0:(le.value&&Se(),t("blur",e))}))},$e=()=>{le.value=!1,t(o,""),t("clear")},xe=async()=>{ie.value&&ae.value>=0&&ae.value<ee.value.length?Ae(ee.value[ae.value]):u.selectWhenUnmatched&&(t("select",{value:u.modelValue}),ee.value=[],ae.value=-1)},we=e=>{ie.value&&(e.preventDefault(),e.stopPropagation(),Se())},Se=()=>{le.value=!1},Ae=async e=>{t(s,e[u.valueKey]),t(o,e[u.valueKey]),t("select",e),ee.value=[],ae.value=-1},ke=e=>{if(!ie.value||oe.value)return;if(e<0)return void(ae.value=-1);e>=ee.value.length&&(e=ee.value.length-1);const a=J.value.querySelector(`.${p.be("suggestion","wrap")}`),t=a.querySelectorAll(`.${p.be("suggestion","list")} li`)[e],l=a.scrollTop,{offsetTop:s,scrollHeight:o}=t;s+o>l+a.clientHeight&&(a.scrollTop+=o),s<l&&(a.scrollTop-=o),ae.value=e,U.value.ref.setAttribute("aria-activedescendant",`${ue.value}-item-${ae.value}`)},Fe=h(Q,(()=>{var e;(null==(e=G.value)?void 0:e.isFocusInsideContent())||ie.value&&Se()}));return y((()=>{null==Fe||Fe()})),$((()=>{U.value.ref.setAttribute("role","textbox"),U.value.ref.setAttribute("aria-autocomplete","list"),U.value.ref.setAttribute("aria-controls","id"),U.value.ref.setAttribute("aria-activedescendant",`${ue.value}-item-${ae.value}`),Z=U.value.ref.hasAttribute("readonly")})),a({highlightedIndex:ae,activated:le,loading:oe,inputRef:U,popperRef:G,suggestions:ee,handleSelect:Ae,handleKeyEnter:xe,focus:()=>{var e;null==(e=U.value)||e.focus()},blur:()=>{var e;null==(e=U.value)||e.blur()},close:Se,highlight:ke,getData:ce}),(e,a)=>(w(),x(k(M),{ref_key:"popperRef",ref:G,visible:k(ie),placement:e.placement,"fallback-placements":["bottom-start","top-start"],"popper-class":[k(p).e("popper"),e.popperClass],teleported:e.teleported,"append-to":e.appendTo,"gpu-acceleration":!1,pure:"","manual-mode":"",effect:"light",trigger:"click",transition:`${k(p).namespace.value}-zoom-in-top`,persistent:"",role:"listbox",onBeforeShow:de,onHide:ve},{content:S((()=>[A("div",{ref_key:"regionRef",ref:J,class:B([k(p).b("suggestion"),k(p).is("loading",k(re))]),style:F({[e.fitInputWidth?"width":"minWidth"]:te.value,outline:"none"}),role:"region"},[C(k(W),{id:k(ue),tag:"ul","wrap-class":k(p).be("suggestion","wrap"),"view-class":k(p).be("suggestion","list"),role:"listbox"},{default:S((()=>[k(re)?(w(),V("li",{key:0},[R(e.$slots,"loading",{},(()=>[C(k(z),{class:B(k(p).is("loading"))},{default:S((()=>[C(k(L))])),_:1},8,["class"])]))])):(w(!0),V(N,{key:1},j(ee.value,((a,t)=>(w(),V("li",{id:`${k(ue)}-item-${t}`,key:t,class:B({highlighted:ae.value===t}),role:"option","aria-selected":ae.value===t,onClick:e=>Ae(a)},[R(e.$slots,"default",{item:a},(()=>[q(D(a[e.valueKey]),1)]))],10,["id","aria-selected","onClick"])))),128))])),_:3},8,["id","wrap-class","view-class"])],6)])),default:S((()=>[A("div",{ref_key:"listboxRef",ref:Q,class:B([k(p).b(),e.$attrs.class]),style:F(k(ne)),role:"combobox","aria-haspopup":"listbox","aria-expanded":k(ie),"aria-owns":k(ue)},[C(k(I),_({ref_key:"inputRef",ref:U},k(n),{clearable:e.clearable,disabled:k(r),name:e.name,"model-value":e.modelValue,"aria-label":e.ariaLabel,onInput:ge,onChange:be,onFocus:he,onBlur:ye,onClear:$e,onKeydown:[E(T((e=>ke(ae.value-1)),["prevent"]),["up"]),E(T((e=>ke(ae.value+1)),["prevent"]),["down"]),E(xe,["enter"]),E(Se,["tab"]),E(we,["esc"])],onMousedown:me}),K({_:2},[e.$slots.prepend?{name:"prepend",fn:S((()=>[R(e.$slots,"prepend")]))}:void 0,e.$slots.append?{name:"append",fn:S((()=>[R(e.$slots,"append")]))}:void 0,e.$slots.prefix?{name:"prefix",fn:S((()=>[R(e.$slots,"prefix")]))}:void 0,e.$slots.suffix?{name:"suffix",fn:S((()=>[R(e.$slots,"suffix")]))}:void 0]),1040,["clearable","disabled","name","model-value","aria-label","onKeydown"])],14,["aria-expanded","aria-owns"])])),_:3},8,["visible","placement","popper-class","teleported","append-to","transition"]))}}),[["__file","autocomplete.vue"]]));export{X as E};
