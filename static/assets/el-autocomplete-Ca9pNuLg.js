import{bC as e,a8 as a,aa as t,ab as l,bE as s,ac as o,bd as u,aQ as n,ad as i,ak as r,d as p,bl as d,a$ as v,bg as c,af as f,r as g,aL as m,I as b,bm as h,v as y,J as $,i as x,o as w,w as S,h as k,a as A,aw as F,n as I,g as C,E as _,bj as B,aq as E,ar as T,b5 as K,al as R,V as W,c as j,C as L,aI as V,F as q,G as N,x as H,t as O,a9 as U,aj as z,at as D}from"./index-B3EiCo2S.js";import{u as J,E as P}from"./el-popper-BVxf87sZ.js";import{d as G}from"./debounce-BcWuyWDS.js";const M=t({valueKey:{type:String,default:"value"},modelValue:{type:[String,Number],default:""},debounce:{type:Number,default:300},placement:{type:i(String),values:["top","top-start","top-end","bottom","bottom-start","bottom-end"],default:"bottom-start"},fetchSuggestions:{type:i([Function,Array]),default:n},popperClass:{type:String,default:""},triggerOnFocus:{type:Boolean,default:!0},selectWhenUnmatched:{type:Boolean,default:!1},hideLoading:{type:Boolean,default:!1},teleported:J.teleported,appendTo:J.appendTo,highlightFirstItem:{type:Boolean,default:!1},fitInputWidth:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},name:String,...u(["ariaLabel"])}),Q={[o]:e=>a(e),[s]:e=>a(e),[l]:e=>a(e),focus:e=>e instanceof FocusEvent,blur:e=>e instanceof FocusEvent,clear:()=>!0,select:a=>e(a)},X="ElAutocomplete",Y=p({name:X,inheritAttrs:!1});const Z=D(r(p({...Y,props:M,emits:Q,setup(e,{expose:a,emit:t}){const u=e,n=d(),i=v(),r=c(),p=f("autocomplete"),D=g(),J=g(),M=g(),Q=g();let Y=!1,Z=!1;const ee=g([]),ae=g(-1),te=g(""),le=g(!1),se=g(!1),oe=g(!1),ue=m(),ne=b((()=>i.style)),ie=b((()=>(ee.value.length>0||oe.value)&&le.value)),re=b((()=>!u.hideLoading&&oe.value)),pe=b((()=>D.value?Array.from(D.value.$el.querySelectorAll("input")):[])),de=()=>{ie.value&&(te.value=`${D.value.$el.offsetWidth}px`)},ve=()=>{ae.value=-1},ce=async e=>{if(se.value)return;const a=e=>{oe.value=!1,se.value||(U(e)?(ee.value=e,ae.value=u.highlightFirstItem?0:-1):z(X,"autocomplete suggestions must be an array"))};if(oe.value=!0,U(u.fetchSuggestions))a(u.fetchSuggestions);else{const t=await u.fetchSuggestions(e,a);U(t)&&a(t)}},fe=G(ce,u.debounce),ge=e=>{const a=!!e;if(t(s,e),t(o,e),se.value=!1,le.value||(le.value=a),!u.triggerOnFocus&&!e)return se.value=!0,void(ee.value=[]);fe(e)},me=e=>{var a;r.value||("INPUT"!==(null==(a=e.target)?void 0:a.tagName)||pe.value.includes(document.activeElement))&&(le.value=!0)},be=e=>{t(l,e)},he=e=>{var a;if(Z)Z=!1;else{le.value=!0,t("focus",e);const l=null!=(a=u.modelValue)?a:"";u.triggerOnFocus&&!Y&&fe(String(l))}},ye=e=>{setTimeout((()=>{var a;(null==(a=M.value)?void 0:a.isFocusInsideContent())?Z=!0:(le.value&&Se(),t("blur",e))}))},$e=()=>{le.value=!1,t(o,""),t("clear")},xe=async()=>{ie.value&&ae.value>=0&&ae.value<ee.value.length?ke(ee.value[ae.value]):u.selectWhenUnmatched&&(t("select",{value:u.modelValue}),ee.value=[],ae.value=-1)},we=e=>{ie.value&&(e.preventDefault(),e.stopPropagation(),Se())},Se=()=>{le.value=!1},ke=async e=>{t(s,e[u.valueKey]),t(o,e[u.valueKey]),t("select",e),ee.value=[],ae.value=-1},Ae=e=>{if(!ie.value||oe.value)return;if(e<0)return void(ae.value=-1);e>=ee.value.length&&(e=ee.value.length-1);const a=J.value.querySelector(`.${p.be("suggestion","wrap")}`),t=a.querySelectorAll(`.${p.be("suggestion","list")} li`)[e],l=a.scrollTop,{offsetTop:s,scrollHeight:o}=t;s+o>l+a.clientHeight&&(a.scrollTop+=o),s<l&&(a.scrollTop-=o),ae.value=e,D.value.ref.setAttribute("aria-activedescendant",`${ue.value}-item-${ae.value}`)},Fe=h(Q,(()=>{var e;(null==(e=M.value)?void 0:e.isFocusInsideContent())||ie.value&&Se()}));return y((()=>{null==Fe||Fe()})),$((()=>{D.value.ref.setAttribute("role","textbox"),D.value.ref.setAttribute("aria-autocomplete","list"),D.value.ref.setAttribute("aria-controls","id"),D.value.ref.setAttribute("aria-activedescendant",`${ue.value}-item-${ae.value}`),Y=D.value.ref.hasAttribute("readonly")})),a({highlightedIndex:ae,activated:le,loading:oe,inputRef:D,popperRef:M,suggestions:ee,handleSelect:ke,handleKeyEnter:xe,focus:()=>{var e;null==(e=D.value)||e.focus()},blur:()=>{var e;null==(e=D.value)||e.blur()},close:Se,highlight:Ae,getData:ce}),(e,a)=>(w(),x(A(P),{ref_key:"popperRef",ref:M,visible:A(ie),placement:e.placement,"fallback-placements":["bottom-start","top-start"],"popper-class":[A(p).e("popper"),e.popperClass],teleported:e.teleported,"append-to":e.appendTo,"gpu-acceleration":!1,pure:"","manual-mode":"",effect:"light",trigger:"click",transition:`${A(p).namespace.value}-zoom-in-top`,persistent:"",role:"listbox",onBeforeShow:de,onHide:ve},{content:S((()=>[k("div",{ref_key:"regionRef",ref:J,class:I([A(p).b("suggestion"),A(p).is("loading",A(re))]),style:F({[e.fitInputWidth?"width":"minWidth"]:te.value,outline:"none"}),role:"region"},[C(A(W),{id:A(ue),tag:"ul","wrap-class":A(p).be("suggestion","wrap"),"view-class":A(p).be("suggestion","list"),role:"listbox"},{default:S((()=>[A(re)?(w(),j("li",{key:0},[R(e.$slots,"loading",{},(()=>[C(A(L),{class:I(A(p).is("loading"))},{default:S((()=>[C(A(V))])),_:1},8,["class"])]))])):(w(!0),j(q,{key:1},N(ee.value,((a,t)=>(w(),j("li",{id:`${A(ue)}-item-${t}`,key:t,class:I({highlighted:ae.value===t}),role:"option","aria-selected":ae.value===t,onClick:e=>ke(a)},[R(e.$slots,"default",{item:a},(()=>[H(O(a[e.valueKey]),1)]))],10,["id","aria-selected","onClick"])))),128))])),_:3},8,["id","wrap-class","view-class"])],6)])),default:S((()=>[k("div",{ref_key:"listboxRef",ref:Q,class:I([A(p).b(),e.$attrs.class]),style:F(A(ne)),role:"combobox","aria-haspopup":"listbox","aria-expanded":A(ie),"aria-owns":A(ue)},[C(A(_),B({ref_key:"inputRef",ref:D},A(n),{clearable:e.clearable,disabled:A(r),name:e.name,"model-value":e.modelValue,"aria-label":e.ariaLabel,onInput:ge,onChange:be,onFocus:he,onBlur:ye,onClear:$e,onKeydown:[E(T((e=>Ae(ae.value-1)),["prevent"]),["up"]),E(T((e=>Ae(ae.value+1)),["prevent"]),["down"]),E(xe,["enter"]),E(Se,["tab"]),E(we,["esc"])],onMousedown:me}),K({_:2},[e.$slots.prepend?{name:"prepend",fn:S((()=>[R(e.$slots,"prepend")]))}:void 0,e.$slots.append?{name:"append",fn:S((()=>[R(e.$slots,"append")]))}:void 0,e.$slots.prefix?{name:"prefix",fn:S((()=>[R(e.$slots,"prefix")]))}:void 0,e.$slots.suffix?{name:"suffix",fn:S((()=>[R(e.$slots,"suffix")]))}:void 0]),1040,["clearable","disabled","name","model-value","aria-label","onKeydown"])],14,["aria-expanded","aria-owns"])])),_:3},8,["visible","placement","popper-class","teleported","append-to","transition"]))}}),[["__file","autocomplete.vue"]]));export{Z as E};
